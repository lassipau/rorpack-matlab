\documentclass[11pt, a4paper]{amsart}
\usepackage{amssymb, array, amsmath, amscd, pdfpages, enumerate, amsthm, setspace, mathtools}
\usepackage[framed,autolinebreaks]{mcode}
\usepackage[papersize={17cm,26cm},total={12.7cm,22.5cm},left=2.15cm]{geometry}

%\usepackage[smartEllipses]{markdown}

\usepackage[utf8]{inputenc}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{overpic}
%\usepackage{mathrsfs}
\usepackage{xcolor}
\usepackage{graphicx} 
\usepackage{ifthen}
\usepackage{listings}
\usepackage{wasysym}
%\lstset{language=Python}
\usepackage[colorlinks=true]{hyperref}


\newcommand{\COMMapproxRC}[1]{{\color{gray}#1}}
\renewcommand{\COMMapproxRC}[1]{}

%\input{Introduction-to-RORPack-for-Matlab.bbl}
\input{CustomCommandsCopy}
%\renewcommand{\Dom}{D}


\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{9} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{9}  % for normal
\DeclareFixedFont{\itm}{T1}{txtt}{m}{it}{9}  % for normal

% Custom colors
%\usepackage{color}
%\definecolor{deepblue}{rgb}{0,0,0.5}
%\definecolor{deepred}{rgb}{0.6,0,0}
%\definecolor{deepgreen}{rgb}{0,0.5,0}
%\lstset{
%language=Python,
%basicstyle=\ttm,
%otherkeywords={self},             % Add keywords here
%keywordstyle=\ttb\color{deepblue},
%emph={MyClass,__init__},          % Custom highlighting
%commentstyle=\itm,
%emphstyle=\ttb\color{deepred},    % Custom highlighting style
%stringstyle=\color{deepgreen},
%frame=tb,                         % Any extra options here
%showstringspaces=false            % 
%}

\renewcommand{\Dom}{D}


\renewcommand{\pmat}[1]{\begin{bmatrix}#1\end{bmatrix}}
\renewcommand{\pmatsmall}[1]{\begin{bsmallmatrix}#1\end{bsmallmatrix}}


\newcommand{\CL}{C_\Lambda}
\newcommand{\CLt}{\tilde{C}_\Lambda}
\newcommand{\CeL}{C_{e\Lambda}}

\newcommand{\contr}[1]{Controller~\##1}



\newcommand{\XB}{X_B}
\newcommand{\XBBd}{X_{B,B_d}}
\newcommand{\ZG}{Z_{\Bc}}


\DeclareMathOperator{\blkdiag}{blockdiag}

\newcommand{\Hinfty}{H_\infty}

\newcommand{\Ac}{\mc{G}_1}
\newcommand{\Bc}{\mc{G}_2}
\newcommand{\Cc}{K}
\newcommand{\Ccone}{K}
\newcommand{\Cctwo}{K}
\newcommand{\Dc}{D_c}


\newcommand{\PARsysopspert}{(\tilde{A},\tilde{B},\tilde{B}_d,\tilde{C},\tilde{D})}
\newcommand{\PARsys}{(A,B,C,D)}
\newcommand{\PARsysS}{(A^S,B^S,C^S,D^S)}
%\newcommand{\PARsysfbops}{(A-B\Dc Q_1\CL, BQ_2\KL,Q_1C Q_1D)}
%\newcommand{\CLops}{(A_e,B_e,C_e,D_e)}

\newcommand{\PARcontr}{(\Ac,\Bc,\Cc,\Dc)}
\newcommand{\PARcontrone}{(\Ac,\Bc,\Cc,\Dcone)}


\newtheorem{theorem}{Theorem}[section]
%\newtheorem{prp}[thm]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}

\numberwithin{equation}{section}


%\newtheorem*{ORPfb}{The Error Feedback Output Regulation Problem}
%\newtheorem*{RORP}{The Robust Output Regulation Problem}
\newenvironment{RORP}{\textbf{The Robust Output Regulation Problem.}\it}{}

\newcommand{\hfun}{h}

%\newcommand{\distref}{h_{\mbox{\scriptsize\textit{sig}}}}
%\newcommand{\distrefk}{\hat{h}_{\mbox{\scriptsize\textit{sig}}}(k)}
\newcommand{\distref}{w_{\mbox{\scriptsize\textit{ext}}}}
\newcommand{\distrefder}{\dot{w}_{\mbox{\scriptsize\textit{ext}}}}
\newcommand{\distrefk}{w^k_{\mbox{\scriptsize\textit{ext}}}}
%\newcommand{\distrefk}{\hat{w}_{\mbox{\scriptsize\textit{ext}}}(k)}

\newcommand{\yrefk}{y^k_{\mbox{\scriptsize\textit{ref}}}}
\newcommand{\wdistk}{w^k_{\mbox{\scriptsize\textit{dist}}}}
%\newcommand{\yrefk}{\hat{y}_{\mbox{\scriptsize\textit{ref}}}(k)}
%\newcommand{\wdistk}{\hat{w}_{\mbox{\scriptsize\textit{dist}}}(k)}
\newcommand{\wdisthat}{\hat{w}_{\mbox{\scriptsize\textit{dist}}}}


\newcommand{\yref}{y_{\mbox{\scriptsize\textit{ref}}}}
\newcommand{\wdist}{w_{\mbox{\scriptsize\textit{dist}}}}
\newcommand{\wdk}[1][k]{w_{\mbox{\scriptsize\textit{dist},$#1$}}}
\newcommand{\yrefpert}{\tilde{y}_{\mbox{\scriptsize\textit{ref}}}}
\newcommand{\wdistpert}{\tilde{w}_{\mbox{\scriptsize\textit{dist}}}}
\newcommand{\ydk}[1][k]{y_{d,#1}}


%\newcommand{\RORname}{RORPack}
\newcommand{\RORname}{\textbf{RORPack}}
\newcommand{\RORnameplain}{RORPack}


% Helpful macros



\newcommand{\shorten}[1]{{\color{gray}#1}}
\renewcommand{\shorten}[1]{}
%\newcommand{\shortencomm}[1]{{\color{purple}#1}}


\begin{document}


\title[Introduction to ``\RORnameplain'']{Introduction to ``\RORname'' for Matlab\\[1ex]\footnotesize\mdseries{A Matlab software package for Robust Output Regulation}}
%\date{\today}
\thispagestyle{plain}

\author{Lassi Paunonen}
\address{Department of Mathematics, Tampere University, PO.\ Box 692, 33101 Tampere, Finland}
 \email{lassi.paunonen@tuni.fi}


\maketitle

\vspace{-3ex}

\begin{center}
  \today
\end{center}

\vspace{3ex}

\begin{abstract}
  This document contains the mathematical introduction to RORPack --- a software package for robust output tracking and disturbance rejection for linear PDE systems. The RORPack library is open-source and freely available at 
https://github.com/lassipau/rorpack/ and
https://github.com/lassipau/rorpack-matlab/
The package contains functionality for automated construction of robust internal model based controllers, simulation of the controlled systems, visualisation of the results, as well as a collection of example cases on robust output regulation of controlled heat and wave equations on 1D and 2D spatial domains.
\end{abstract}

{\small\tableofcontents}


\section*{Download links}


Both the Python and Matlab versions of \RORname\ software are distributed as open source under the GNU General Public License version 3 (see \texttt{LICENSE.txt} for detailed license and copyright information) and can freely downloaded at the addresses
\begin{flushleft}
 \hspace{1.6cm} \href{https://github.com/lassipau/rorpack/}{https://github.com/lassipau/rorpack/} \hspace{1.4cm} (Python version)\\
 \hspace{1.6cm}  \href{https://github.com/lassipau/rorpack-matlab/}{https://github.com/lassipau/rorpack-matlab/} \hspace{.1cm} (Matlab version)
\end{flushleft}
%\shorten{
The project version information can be found in the \texttt{CHANGELOG.md} files, and installation instructions are included in the \texttt{README.md} files.

\section{General Description}
%\label{sec:intro}

\RORname\ is a software package
for controller design and simulation of robust output tracking and disturbance rejection for linear partial differential equation (PDE) models. 
The package is available as a Python library and a Matlab package.
%Its main purpose is to give an  
The software contains a number of complete examples on robust controller design and simulation of PDE models
%. The types of models (at the moment) include
of the following types:
\begin{itemize}
  \item one-dimensional (1D) and two-dimensional (2D) diffusion equations with control and observation either at the boundary or inside the spatial domain.
%  \item two-dimensional heat equation on a rectangular domain.
  \item 1D wave equations with either boundary or in-domain control and observation.
    \item A 2D wave equation on an annulus with boundary control and observation
\item 1D beam equations with boundary or in-domain control and observation.
\end{itemize}
New examples will also be added in the future versions of the package.
%This collection of examples will also be expanded in the future.
%and a collection of examples on robust output tracking and disturbance rejection for distributed parameter systems.

The purpose of this document is to give a general introduction to the background theory of robust output regulation for linear PDE systems (Section~\ref{sec:RORPintro}), 
 to document the usage of the software package on a general level (Sections~\ref{sec:Usage} and Section~\ref{sec:ControllerTypes}), and 
to describe the mathematical models that are included as the example cases (Section~\ref{sec:PDEcases}).
 
The purpose of \RORname\ is to serve as a tool to \textit{illustrate} the theory of robust output regulation for distributed parameter systems and it should not (yet) be considered as a serious controller design software. 
The developers of the software do not take any responsibility and are not liable for any damage caused through use of this software.
In addition, at its present stage, the library is not optimized in terms of numerical accuracy. Any helpful comments on potential improvements of the numerical aspects will be greatly appreciated!

  This documentation is also published in \href{https://arxiv.org/}{arXiv.org}.
%}
The website of the project is located at the address (hosted by GitHub Pages)
\begin{center}
  \href{https://lassipau.github.io/rorpack/}{https://lassipau.github.io/rorpack/}
\end{center}
All comments and suggestions for improvements are welcome! These can be sent directly to \texttt{\href{mailto:lassi.paunonen@tuni.fi}{lassi.paunonen@tuni.fi}}.

\subsection{Controller Design and Simulation Workflow}

Basic workflow for robust controller design and simulation for a given system is that the user creates a ``main simulation file'' with the following parts:
\begin{enumerate}
%  \item Create a main file for the simulation. 
%    The file includes the following parts in the given order.
  \item Calling of a user-defined Matlab function that returns a numerical approximation of the linear PDE model. In the provided examples this function is in a separate file with the prefix ``Constr''.
  \item Defining the reference and disturbance signals to be considered.
  \item Calling of a \RORname\ routine for construction of a ``robust controller'' that is suitable for the type of the PDE model.
    This also involves defining the parameters of the controller construction.
  \item Calling of \RORname\ routines for construction and simulation of the closed-loop system. The routines return numerical data describing the output, the error, the control signal, and the closed-loop state.
  \item Calling of \RORname\ routines for visualising the behaviour of the output and the output error, as well as 
    user-defined routines for illustrating the behaviour of the state of the controlled PDE system (multidimensional plots or animations).
\end{enumerate}
The example cases included in \RORname\ are built around main files that follow the above structure, and the users are encouraged to implement their own simulations by modifying the example codes.

It is also possible to combine other Python software packages and Matlab toolboxes in the study of robust controller design for PDE models in order to employ ready-made numerical approximations or additional numerical methods in the computation of required controller parameters.
 This approach is illustrated the PDE example cases ``\texttt{Heat1DCase2\_Main}'' (see Section~\ref{sec:Heat1D2}) and 
 ``\texttt{BeamKelvinVoigt\_Main}'' (see Section~\ref{sec:BeamKV}) 
both of which utilise the \textbf{Chebfun package}~\cite{DriHal14book} (\href{https://chebfun.org/}{https://chebfun.org/}), 
  which provides flexible tools for numerical approximation with Chebyshev polynomials and solution of differential equations with extreme accuracy using spectral methods. 
In \texttt{Heat1DCase2\_Main} the \textbf{Chebfun} package is used to compute high-accuracy approximations of the \emph{transfer function} of the controlled PDE system, and 
in \texttt{BeamKelvinVoigt\_Main} the package is used to implement a spectral Galerkin approximation~\cite{She95} of an Euler--Bernoulli beam with nonlocal basis based on Chebyshev polynomials.

%(Case Euler-Bernolli Beam with Kelvin-Voigt Damping).  In this example the system is approximated using the Galerkin method based on a nonlocal basis based on Chebyshev polynomials with  which provides flexible tools for solutions of differential equations with extreme accuracy using spectral methods. 

\section{Introduction to Robust Output Regulation}
\label{sec:RORPintro}

In this section we give a general introduction to the mathematical theory of \keyterm{robust output regulation}.
The purpose of the \RORname\ package is to illustrate controller design for linear distributed parameter systems of the form
\begin{subequations}
  \label{eq:plantintro}
  \eqn{
  \dot{x}(t)&=Ax(t)+Bu(t) + B_d\wdist(t), \qquad x(0)=x_0\in X\\
  y(t)&=\CL x(t)+Du(t) + D_d\wdist(t)
  } 
\end{subequations}
on a Banach or a Hilbert space $X$.
Controlled linear PDE models describing diffusion-convection phenomena, waves and vibrations and elastic deformations can be written in this form with a suitable differential operator~$A$~\cite{CurZwa95book,TucWei09book,JacZwa12book}. 
%generating a \keyterm{strongly continuous semigroup} on $X$.
In our main control problem the goal is to design a dynamic error feedback controller in such a way that
\begin{quotation}
 ``the output $y(t)$ of the system converges to a given reference signal $\yref(t)$ despite the external disturbance signal $\wdist(t)$''. 
\end{quotation}
In addition, the controller needs to be \keyterm{robust} in the sense that it achieves the output tracking and disturbance rejection even if the parameters $(A,B,B_d,C,$ $D,D_d)$ are perturbed or contain small uncertainties.

Our main emphasis is on robust output regulation of \keyterm{diffusion-convection equations}, \keyterm{wave equations}, and \keyterm{beam and plate equations}. However, the \RORname\ package can also be used for construction of controllers for  finite-dimensional systems with given matrices $(A,B,B_d,C,D,D_d)$. 

The full robust output regulation problem is defined in the following way. 

\medskip

\begin{RORP}
  Given a reference signal $\yref(t)$, design a dynamic error feedback controller such that the output $y(t)$ of the system converges to the reference signal asymptotically, i.e.,
  \eqn{
    \label{eq:errconv}
    \lim_{t\to \infty}\; \norm{y(t)-\yref(t)}_Y=0
  }
  despite the disturbance signal $\wdist(t)$.
  Moreover, the controller is required to
%  achieve closed-loop stability and to
be \keyterm{robust} in the sense that it achieves the convergence of the output~\eqref{eq:errconv} even under small uncertainties and changes in the parameters $(A,B,B_d,C,$ $D,D_d)$ of the system.
\end{RORP}

The reference signal $\yref(t)$ and the  disturbance signals $\wdist(t)$ are assumed to be of the form
\begin{subequations}
  \label{eq:yrefwdist}
  \eqn{
    \yref(t) &= a_0^1 + \sum_{k=1}^q (a_k^1 \cos(\gw_k t) + b_k^1 \sin(\gw_k t))\\
    \wdist(t) &= a_0^2 + \sum_{k=1}^q (a_k^2 \cos(\gw_k t) + b_k^2 \sin(\gw_k t))
  }
\end{subequations}
for some \textbf{known frequencies} $\set{\gw_k}_{k=0}^q\subset \R$ with $0=\gw_0<\gw_1<\ldots<\gw_q$ and unknown amplitudes $\set{a_k^j}_{k,j},\set{b_k^j}_{k,j}\subset \R$ (some of which may zero). 

Dynamic feedback is essential for achieving robust output regulation, and the control problem can indeed be solved with a dynamic error feedback controller (see Figure~\ref{fig:FBcontrol}). The classical \keyterm{internal model principle} gives a characterization for the controllers that solve the robust output regulation problem. This fundamental result was first introduced for finite-dimensional linear systems in the 1970's by Francis and Wonham~\cite{FraWon75a} and Davison~\cite{Dav76} (see~\citel{Hua04book}{Ch. 1} for an excellent overview).
The internal model principle was later extended for infinite-dimensional linear systems by the Systems Theory Research Group at Tampere, Finland in the references~\cite{Imm06phd,PauPoh10,Pau11phd,PauPoh14a,Pau16a}\footnote{Our focus is on linear systems, but there is also an extensive literature on the internal model principle for nonlinear systems, see, e.g.,~\cite{Hua04book,ByrIsi03,ByrIsi04} and references therein.}.

\vspace{-.3cm}

\begin{figure}[h!]
  \begin{center}
    \includegraphics[width=.75\linewidth]{FB-control-scheme-horizontal-slim-notation} 
%    \begin{overpic}[width=\linewidth]{FB-control-scheme-horizontal-slim} 
%      \put(67,10.5){\mbox{System}}
%      \put(24.5,10.5){\mbox{Controller}}
%      \put(75,21){\mbox{\small$w_{\textit{\tiny dist}}(t)$}}
%      \put(50,14.5){\mbox{\small$u(t)$}}
%      \put(92,14.5){\mbox{\small$y(t)$}}
%      \put(11.5,14.5){\mbox{\small$e(t)$}}
%      \put(5.5,8){\mbox{\small$-$}}
%      \put(0,14.5){\mbox{\small$y_{\textit{\tiny ref}}(t)$}}
%    \end{overpic}
    \caption{Dynamic error feedback control scheme.}
    \label{fig:FBcontrol}
  \end{center}
\end{figure}

\vspace{-.3cm}

The internal model principle~\cite[Thm. 6.9]{PauPoh10} is also the most important tool in designing controllers for robust output regulation. The result states that a controller solves the robust output regulation problem if and only if the following conditions are satisfied.
\begin{itemize}
  \item The error feedback controller incorporates ``an internal model'' of
    the signals $\yref(t)$ and $\wdist(t)$ in~\eqref{eq:yrefwdist}.
  \item The closed-loop system is exponentially or strongly stable.
\end{itemize}
In controller design, the internal model property can be guaranteed by choosing a suitable \keyterm{structure} for the controller. The rest of parameters are subsequently chosen so that the closed-loop system becomes stable.



The detailed description of the theory of robust output regulation problem and the internal model principle  can be found in the references listed below. The main emphasis in the list is (shamelessly) on the publications by the Systems Theory Research Group at Tampere University, Finland.  All preprints are available at \href{https://sysgrouptampere.wordpress.com/publications/}{https://sysgrouptampere.wordpress.com/publications/}
\begin{itemize}
  \item \cite{Poh82,XuJer95,HamPoh96a,LogTow97,HamPoh00,RebWei03,LogTow03,ImmPoh06b,Imm07a,DosBas08,BouIdr09,HamPoh10,HamPoh11,PauPoh13a,XuSal14}: Robust controller design in various forms for infinite-di\-men\-sional linear systems (including PI-control for PDE models).
  \item \cite{PauPoh10} and~\cite{PauPoh14a}: The Internal Model Principle for infinite-dimensional linear systems with bounded and unbounded, respectively, input and output operators $B$ and $C$.
  \item \cite{Pau16a,Pau17b}: Robust controller design for \keyterm{regular linear systems}.
  \item \cite{HumPau18,HumKur19,PauLeG22}: Robust controller design for \keyterm{port-Hamiltonian systems} and other boundary controlled partial differential equations.
  \item \cite{RebWei03,Pau19,PauLeGLHMNC18,PauLeG22}: Robust controller design \keyterm{impedance passive systems}.
  \item \cite{PauPha20,PhaPau21,HuhPauMTNS20,PauPhaMTNS20}: Robust finite-dimensional low-order controller design for parabolic systems using Galerkin approximations and model reduction.
  \item \cite{Poh81a,Sch83b,ByrLau00,Deu11,NatGil14,AulGil15book,XuDub17a,AulGil19,AulGil21arxiv}: References on the output regulation \keyterm{without} the robustness requirement.
\end{itemize}

The considered \keyterm{dynamic error feedback controllers} are of the form
\begin{subequations}
  \label{eq:controller}
  \eqn{
    \dot{z}(t)&=\mc{G}_1  z(t) + \mc{G}_2 (y(t)-\yref(t)),\qquad z(0)=z_0\in Z\\
    u(t) &= K z(t) +D_c (y(t)-\yref(t)).
  }
\end{subequations}
Here $y(t)-\yref(t)$ is the \keyterm{regulation error}.
The constructions of the robust controllers in \RORname\ are based on the references~\cite{RebWei03,Pau16a,Pau19,PauPha20} with certain modifications and improvements (see Section~\ref{sec:ControllerTypes}). In particular, the internal models are defined in their ``real forms'', making the controller real whenever the parameters of the plant~\eqref{eq:plantintro} are real. The same controllers also achieve robust output tracking also for reference and disturbance signals with complex amplitudes
 $\set{a_k^j}_{k,j},\set{b_k^j}_{k,j}\subset \C$.

The constructions of the robust controllers use the knowledge of the frequencies $\set{\gw_k}_k $ of the reference and disturbance signals, the number of outputs $p:=\dim Y$ of the system~\eqref{eq:plantintro}, and certain knowledge of the system. In particular, the ``Low-Gain Controller'' requires knowledge of the values $P(i\gw_k)$ of the transfer function $P(\gl)=\CL R(\gl,A)B+D$ of the system~\eqref{eq:plantintro} at the complex frequencies $\set{i\gw_k}_k\subset i\R$ of the reference and disturbance signals~\eqref{eq:yrefwdist}.
The other controller structures also use knowledge of the parameters $(A,B,C,D)$ of the system as they involve designing an observer for~\eqref{eq:plantintro}, and require the user to provide stabilizing state feedback and output injection operators. See Section~\ref{sec:ControllerTypes} for the controller-specific requirements.

\section{Using the Software (Matlab version)}
\label{sec:Usage}

The \texttt{rorpack} Matlab library can be installed for Matlab R2019a and later\footnote{Earlier versions should be fine, but have not been tested. Let us know of any issues!} as instructed in the \texttt{README.md} file included in the software package (this mainly involves copying the package on your hard drive and adding the ``RORPack'' folder and its subfolders to the Matlab PATH). The subdirectory \texttt{examples/} contains the included PDE examples and simulation files (documented in detail in Section~\ref{sec:PDEcases}).

The following commented example file explains the typical structure and workflow of the controller construction and simulation with \RORname. The considered example cases are included in the files \texttt{Heat1DCase3\_Main.m} and \texttt{ConstrHeat1DCase3.m} and are documented in Section~\ref{sec:Heat1D3}. Due to the properties of Matlab the constructor routine used in the main simulation file is in its own separate Matlab function file with the prefix ``\texttt{Constr}''.

%Contents of the files \texttt{Heat1DCase3\_Main.m} and \texttt{ConstrHeat1DCase3.m}: 
The main file \texttt{Heat1DCase3\_Main.m} begins with general comment lines.
% and adding the ``RORPack'' folder to the top of the search path for the current Matlab session.

\begin{lstlisting}
%% Heat equation on the interval [0,1] with 
% Neumann boundary control and Dirichlet boundary observation 
% Approximation with a Finite differences scheme 

% Two distributed control inputs and two distributed outputs y(t),
% Neumann boundary disturbance at x=0. The controls act on the
% intervals 'IB1' and 'IB2' (Default 'IB1' = [0.3,0.4] and
% 'IB2' = [0.6,0.7]) and the measurements are the average
% temperatures on the intervals 'IC1'  and 'IC2' (Default
% 'IC1' = [0.1,0.2] and 'IC2' = [0.8,0.9]).
\end{lstlisting}

The next part defines the parameters $N$, \texttt{cfun} and \texttt{x0fun} used in the construction of  $(A,B,B_d,C,D,D_d)$ with routine \texttt{ConstrHeat1DCase3.m} (detailed below). The parameter $N$ is the size of the approximation and \texttt{cfun} is a function describing the spatially varying thermal diffusivity of the material. \texttt{x0fun} describes the initial heat profile of the plant.
In this example, the parameters \texttt{IB1} and \texttt{IB2} describe the two intervals where the control is applied to the heat equation, and \texttt{IC1} and \texttt{IC2} describe the internvals of the measurements from the heat equation.

\begin{lstlisting}
% Parameters for this example.
% Size of the numerical approximation.
N = 100; 

% Initial state of the plant
%x0fun = @(x) zeros(size(x));
x0fun = @(x) 1*(1+cos(pi*(1-x)));
%x0fun = @(x) 3*(1-x)+x;

% The spatially varying thermal diffusivity of the material
% cfun = @(xi) ones(size(xi));
cfun = @(xi) 0.3-0.6*xi.*(1-xi);

IB1 = [.3, .4];  IB2 = [.6, .7];  IC1 = [.1, .2];  IC2 = [.8, .9];

[x0,Sys,spgrid,BCtype] = ConstrHeat1DCase3(cfun,x0fun,N,IB1,IB2,IC1,IC2);
 \end{lstlisting}

The function \texttt{ConstrHeat1DCase3.m} used in constructing the approximation of the PDE system begins with comment lines, checking if \texttt{IB1}, \texttt{IB2}, \texttt{IC1} and \texttt{IC2} are given as parameters (or if these should be set to default values), and a consistency check for the parameters.
% approximate the system begins with comments describing this particular approximation along with argument checking since the inputs \texttt{IB1}, \texttt{IB2}, \texttt{IC1} and \texttt{IC2} are not explicitly required to construct the approximation.

\begin{lstlisting}
function [x0,Sys,spgrid,BCtype] = Constr1DHeatCase3(...
    cfun,x0fun,N,IB1,IB2,IC1,IC2)
% Finite Differences approximation of a 1D Heat equation with
% different types of distributed/boundary control and observation.
%
% Case 3: Two distributed control inputs and two distributed 
% outputs y(t), Neumann boundary disturbance at x=0. The controls 
% affect the intervals 'IB1' = [a_1,b_1] and 'IB2' = [a_2,b_2],
% and the measurements are the averages of the temperatures on the
% intervals 'IC1' = [c_1,d_1] and 'IC2' = [c_2,d_2]. If these
% parameters are not given, then defaults IB1 = [.3, .4],
% IB2 = [.6, .7], IC1 = [.1, .2], and IC2 = [.8, .9] are used.

if nargin <= 3
  IB1 = [.3, .4]; IB2 = [.6, .7]; IC1 = [.1, .2]; IC2 = [.8, .9];
end

% Check that the intervals are defined correctly
if ~isempty(find([IB1(:);IB2(:);IC1(:);IC2(:)]<0))...
        || ~isempty(find([IB1(:);IB2(:);IC1(:);IC2(:)]>1))
  error('All limits of the intervals IB1, IB2, IC1, and IC2 need to be on [0,1].')
elseif IB1(2)<=IB1(1) || IB2(2)<=IB2(1) ||...
        IC1(2)<=IC1(1) || IC2(2)<=IC2(1)
  error('All intervals IB1, IB2, IC1, and IC2 need to be of positive lengths.')
end
  \end{lstlisting}

The rest of the code constructs a Finite Difference approximation of the heat equation on $[0,1]$ with the two distributed inputs (on the invervals \texttt{IB1} and \texttt{IB2}) and the two measured outputs, which are the temperature averages over the intervals \texttt{IC1} and \texttt{IC2}. The second order differential operator is constructed using the general-purpose \RORname\ routine \texttt{DiffOP1d} for approximation of a diffusion operator with a spatially varying diffusion coefficient.
Also the Neumann boundary disturbance operator $B_d$ and the initial state $x_0$ are approximated according to the same Finite Difference approximation. At the end of the code, all parameters of the system are saved to the main variable \texttt{Sys}, which is a Matlab structure with fields 
\texttt{A}, \texttt{B}, \texttt{Bd},  
\texttt{C}, \texttt{D}, \texttt{Dd}
corresponding to the parameters $(A,B,B_d,C,D,D_d)$ of~\eqref{eq:plantintro}.

\begin{lstlisting}
% The point x=1 has a Dirichlet boundary condition
% and is not chosen as a state variable
spgrid = linspace(0,1,N+1);
h = 1/N;
% Case 3 has a Neumann boundary condition at x=0
% and a Dirichlet condition at x=1
BCtype = 'ND';

[A,spgrid] = DiffOp1d(cfun,spgrid,BCtype);

% Two distributed inputs on the intervals IB1 and IB2
B1 = 1/(IB1(2)-IB1(1))*(spgrid(1:N)>=IB1(1) & spgrid(1:N)<=IB1(2));
B1 = B1(:);
B2 = 1/(IB2(2)-IB2(1))*(spgrid(1:N)>=IB2(1) & spgrid(1:N)<=IB2(2));
B2 = B2(:);

% Neumann boundary disturbance at x=0, sign is based on the
% outwards normal derivative
Bd = sparse([2/h;zeros(N-1,1)]); 

% Two distributed outputs on the intervals IC1 and IC2
C1 = h/(IC1(2)-IC1(1))*(spgrid(1:N)>=IC1(1) & spgrid(1:N)<=IC1(2));
C2 = h/(IC2(2)-IC2(1))*(spgrid(1:N)>=IC2(1) & spgrid(1:N)<=IC2(2));

x0 = x0fun(spgrid(1:N)).';

Sys.A = A;
Sys.B = [B1,B2];
Sys.Bd = Bd;
Sys.C = [C1;C2];
Sys.D = zeros(2,2);
Sys.Dd = zeros(2,1);
  \end{lstlisting}

The next part of the main file defines the reference signal $\yref(t)$ (in \texttt{yref}) and the disturbance signal $\wdist(t)$ (in \texttt{wdist}) and lists the (real) frequencies $\set{\gw_k}_{k=1}^q$ in the variable \texttt{freqsReal}. Alternative reference and disturbance signals are commented out in the code for further simulation experiments.
Finally, a consistency check of \texttt{Sys}, \texttt{freqsReal}, \texttt{yref}, and \texttt{wdist} is completed using the routine \texttt{SysConsistent}.
\emph{If disturbance inputs are not present in the studied PDE model, $\wdist(t)$ should be defined as a zero signal with \textup{\texttt{wdist = @(t) zeros(size(t))}}. Also \textup{\texttt{Sys.Bd}} and \textup{\texttt{Sys.Dd}} should be defined as $\textup{dimX}\times 1$ and $\textup{dimY}\times 1$ zero matrices, and this can be done automatically using the function \textup{\texttt{SysConsistent}}.}

\begin{lstlisting}
% Define the reference and disturbance signals, and list the
% required frequencies in 'freqsReal'

% Case 1:
yref = @(t) [sin(2*t);2*cos(3*t)];
%wdist = @(t) zeros(size(t));
wdist = @(t) sin(6*t);
freqsReal = [1, 2, 3, 6];

% Check the consistency of the system definition
Sys = SysConsistent(Sys,yref,wdist,freqsReal);
\end{lstlisting}

The next part constructs the chosen controller structure with the corresponding function from the \RORname\ ``controllers'' folder. Alternative controller structures are commented out in the code for easy comparison of controller performances.
The use of the controller construction routines is documented in detail in Section~\ref{sec:ControllerTypes} as well as in the the comments of the example files.

\begin{lstlisting} 
%% Construct the controller

% A Reduced Order Observer Based Robust Controller
%
% The construction of the controller uses a Galerkin approximation
% of the heat system.
% The Galerkin approximation used in the controller design 
% is a lower dimensional numerical approximation of the PDE model.
Nlow = 50;
[~,Sys_Nlow,~,~] = Constr1DHeatCase3(cfun,x0fun,Nlow,IB1,IB2,...  
                                     IC1,IC2);

% Store the numerical approximation in "SysApprox".
SysApprox.AN = Sys_Nlow.A;
SysApprox.BN = Sys_Nlow.B;
SysApprox.CN = Sys_Nlow.C;
SysApprox.D = Sys_Nlow.D;

% Parameters for the stabilization step of the controller design
alpha1 = 1;
alpha2 = 0.5;
% Size of Q0 = dimension of the internal model
Q0 = eye(IMdim(freqsReal,size(SysApprox.CN,1))); 
Q1 = eye(size(SysApprox.AN,1)); % Size = dim(V_N)
Q2 = eye(size(SysApprox.AN,1)); % Size = dim(V_N)
R1 = eye(size(SysApprox.CN,1)); % Size = dim(Y)
R2 = eye(size(SysApprox.BN,2)); % Size = dim(U)

% Size of the final reduced-order observer part of the controller
ROMorder = 3;

ContrSys = ObserverBasedROMRC(freqsReal,SysApprox,alpha1,...
                              alpha2,R1,R2,Q0,Q1,Q2,ROMorder);
\end{lstlisting}

The next part constructs and simulates the behaviour of the closed-loop system. In particular, \texttt{CLSys} is a Matlab structure which stores the main operators $(A_e,B_e,C_e,D_e)$ of the closed-loop system in the fields \texttt{CLSys.Ae}, \texttt{CLSys.Be},   \texttt{CLSys.Ce}, and \texttt{CLSys.De}\footnote{There are different conventions in the literature for definition of the ``inputs'' of the closed-loop system (and the definition of $B_e$). \RORname\ uses the version where the input of the closed-loop system is $(\wdist(t),\yref(t))^T$ (like in~\cite{PauPha20}), instead of the state of \keyterm{an exosystem}.}.

\begin{lstlisting}
%% Closed-loop construction and simulation

% Construct the closed-loop system
CLSys = ConstrCLSys(Sys,ContrSys);

% Print an approximate stability margin of the closed-loop system
stabmarg = CLStabMargin(CLSys)

% Define the initial state of the closed-loop system
% (the controller has zero initial state by default).
xe0 = [x0;zeros(size(ContrSys.G1,1),1)];

% Set the simulation length and define the plotting grid
Tend = 8;
tgrid = linspace(0,Tend,300);

% Simulate the closed-loop system
CLsim = SimCLSys(CLSys,xe0,yref,wdist,tgrid,[]);
\end{lstlisting}

Finally, the results of the simulation are plotted in separate figures and the behaviour of the controlled state is animated using the user-defined routines. Code for saving the animation as an MPEG-4 or AVI file is commented out.

\begin{lstlisting}
%% Visualization

% Plot the (approximate) eigenvalues of the closed-loop system
figure(1)
PlotEigs(CLSys.Ae,[-30 .3 -6 6])

% Choose whether or not to print titles of the figures
PrintFigureTitles = true;

% Plot the controlled outputs, the tracking error norm, and 
% the control inputs
figure(2)
subplot(3,1,1)
PlotOutput(tgrid,yref,CLsim,PrintFigureTitles)
subplot(3,1,2)
PlotErrorNorm(tgrid,CLsim,PrintFigureTitles)
subplot(3,1,3)
PlotControl(tgrid,CLsim,PrintFigureTitles)

% In plotting and animating the state,
% fill in the homogeneous Dirichlet boundary condition at x=1
spgrid = [spgrid, 1];

figure(3)
Plot1DHeatSurf(CLsim.xesol(1:N,:),spgrid,tgrid,BCtype)

figure(4)
% No movie recording
[~,zlims] = Anim1DHeat(CLsim.xesol(1:N,:),spgrid,tgrid, ...
                       BCtype,0.03,0);
% Movie recording
% [MovAnim,zlims] = Anim1DHeat(CLsim.xesol(1:N,:),spgrid,tgrid,...
%                               BCtype,0.03,1);

figure(5)
tt = linspace(0,16,500);
plot(tt,yref(tt),'Color',1.1*[0 0.447 0.741],'Linewidth',3);
title('Reference $y_{ref}$','Interpreter','latex','Fontsize',16)
\end{lstlisting}


\section{Implemented Controller Types}
\label{sec:ControllerTypes}

In this section we list the concrete controllers implemented in \RORname.
The documentation of the code includes additional information on the usage of the construction routines.
The controllers are the following:
\begin{itemize}
  \item The ``Low-Gain (Minimal) Robust Controller'' (including only the internal model), based on references~\cite{HamPoh00,RebWei03},~\citel{Pau16a}{Sec. IV}. Stabilization of the closed-loop system is based on selection of a suitable \keyterm{low-gain parameter} $\eps>0$. This controller can be used for systems which are exponentially stable (or stabilizable with output feedback).\\[1ex]
      Calling sequence for the construction:\\[-1ex]
     \begin{quotation}
       \texttt{LowGainRC(freqsReal,Pvals,epsgain,Sys,Dc)}
     \end{quotation}
     \medskip
     where \texttt{Sys} contains the parameters of the plant, \texttt{freqsReal} contains the frequencies $\set{\gw_k}_{k=0}^q$ of the signals $\yref(t)$ and $\wdist(t)$ in~\eqref{eq:yrefwdist}, \texttt{epsgain} is the value of the low-gain parameter $\eps>0$. 
The (optional) parameter \texttt{Dc} is the feedthrough matrix $D_c$ of the controller~\eqref{eq:controller}. Since the controller feedthrough 
 is equivalent to a ``preliminary'' output feedback  $u(t)=D_c y(t)+ \tilde{u}(t)$ to the system (plus an additional disturbance term), for unstable systems the parameter \texttt{Dc} should be an output feedback matrix which stabilizes the system exponentially. 
If \texttt{Dc} is not given, the controller will by default have zero feedthrough.

The parameter \texttt{Pvals} is a is a Matlab cell array of length $q+1$ containing transfer function values $P_{D_c}(i\gw_k)\in \C^{p\times m}$ at the complex frequencies $\set{i\gw_k}_{k=0}^q$ of $\wdist(t)$ and $\yref(t)$. Here $P_{D_c}(\gl)$ is the transfer function of the system $(A^{D_c},B^{D_c},C^{D_c},D^{D_c})$ which is obtained from $(A,B,C,D)$ with output feedback $u(t)=D_c y(t)+ \tilde{u}(t)$.
The values have the theoretical formula
 $$P_{D_c}(i\gw_k)=\CL^{D_c} R(i\gw_k,A^{D_c})B^{D_c}+D^{D_c},$$
 but they can also be computed via a solution of a boundary value problem (see, e.g., \texttt{Heat1DCase2\_Main.m} in Section~\ref{sec:Heat1D2}), or measured from the response of a physical model. 
If the
transfer function $P(\gl)$ of $(A,B,C,D)$ is well-defined at
$iw_k$, then $P_{D_c}(i\gw_k)$ can be computed with the formula 
$P_{D_c}(i\gw_k) = (I-P(i\gw_k)Dc)\inv P(i\gw_k)$, and if $D_c=0$, then 
$P_{Dc}(i\gw_k) = P(i\gw_k)$. See Section~\ref{sec:ContrParameterComments} for additional comments.
% of the transfer function of~\eqref{eq:plantintro} at the complex frequencies $\set{i\gw_k}_{k=0}^q$ of the reference and disturbance signals in~\eqref{eq:yrefwdist}.


     The parameter \texttt{epsgain} can alternatively be a vector of length 2 providing minimal and maximal values for $\eps$. The controller construction has a naive functionality for finding an $\eps$ to optimize stability margin of the numerically approximated closed-loop system (simply by starting from the minimal value and increasing $\eps$ in steps). 

     \bigskip

  \item The ``Observer Based Robust Controller'', based on references~\citel{HamPoh10}{Sec. 7},~\citel{Pau16a}{Sec. VI},~\citel{Pau17b}{Sec. 5}. The closed-loop stability is achieved using an observer for the state of the system~\eqref{eq:plantintro}. This controller can be used for both stable and unstable systems.\\[1ex]
      Calling sequence for the construction:\\[-1ex]
     \begin{quotation}
       \texttt{ObserverBasedRC(freqsReal,Sys,K21,L,\\ 
	 \phantom{a}\hspace{2.9cm} IMstabtype,IMstabmarg)}
     \end{quotation}
     \medskip
     where \texttt{Sys} contains the parameters of the plant and \texttt{freqsReal} contains the frequencies $\set{\gw_k}_{k=0}^q$ of the signals $\yref(t)$ and $\wdist(t)$ in~\eqref{eq:yrefwdist}.
     The parameters \texttt{K21} and \texttt{L} describe operators $K_{21}$ and $L$ such that $A+BK_{21}^\Lambda$ and $A+L\CL$ generate exponentially stable semigroups. 

     Instead of the approach used in~\cite{Pau16a}, the ``internal model'', i.e., the pair $(G_1,B_1)$, in the controller is stabilized using either LQR-based design (\texttt{IMstabtype = 'LQR'}) or pole placement (\texttt{IMstabtype = 'poleplacement'}) with a stability margin \texttt{IMstabmarg}. Note that the variable \texttt{IMstabmarg} only determines the stability margin of the internal model, and the stability margin of the closed-loop system also depends on the stability margins of the semigroups generated by $A+BK_2^\Lambda$ and $A+L\CL$.
     
     \bigskip
     
\item 
The ``The Reduced Order Observer Based Robust Controller'', for \emph{parabolic} PDE systems, especially convection-diffusion-reaction equations. The controller design is based on Galerkin approximations and model reduction via Balanced Truncation, and was introduced in the reference~\cite{PauPha20} (see also~\cite{PhaPau21} for systems with boundary control).\\[1ex]
      Calling sequence for the construction:\\[-1ex]
     \begin{quotation}
       \hspace{-1cm}\texttt{ObserverBasedROMRC(freqsReal,sysApprox,alpha1,alpha2,\\ 
	 \phantom{a}\hspace{3.0cm} R1,R2,Q0,Q1N,Q2N,ROMorder)}
     \end{quotation}
     \medskip
     where \texttt{sysApprox} contains the parameters of the Galerkin approximation $(A^N,B^N,C^N,D)$ of the plant parameters $(A,B,C,D)$ (a struct with fields \texttt{sysApprox.AN}, \texttt{sysApprox.BN}, \texttt{sysApprox.CN}, \\ \texttt{sysApprox.D}) and \texttt{freqsReal} contains the (real) frequencies $\set{\gw_k}_{k=0}^q$ of the signals $\yref(t)$ and $\wdist(t)$ in~\eqref{eq:yrefwdist}.
The parameters \texttt{alpha1}, \texttt{alpha2},
\texttt{R1}, \texttt{R2}, \texttt{Q0}, \texttt{Q1N}, \texttt{Q2N} are parameters for the LQR/LQG-based stabilization of the closed-loop system (details below). Finally, \texttt{ROMorder} is the desired dimension of the reduced order ``observer part'' of the controller. The final controller has dimension which is equal to the dimension of the internal model plus \texttt{ROMorder}.

The parameters \texttt{alpha1} and \texttt{alpha2} correspond to $\ga_1,\ga_2\geq 0$ in~\citel{PauPha20}{Sec.~III.A}, and are used as design parameters to determine the closed-loop stability margin (the choice $\ga_1=\ga_2=0$ is possible). In particular, $(A+\ga_k I,B,C)$ should be exponentially stabilizable and detectable for $k=1,2$.
The parameters 
\texttt{R1}, \texttt{R2}, and \texttt{Q0} correspond to $R_1\in \Lin(Y)$, $R_2\in \Lin(U)$, and $Q_0\in \R^{n_{IM}\times n_{IM}}$ (where $n_{IM}\in \N$ is the dimension of the internal model). All these matrices should be chosen to be invertible and positive definite, and for example choices $R_1=r_1 I$, $R_2=r_2 I$, $Q_0=q_0 I$ for some $r_1,r_2,q_0>0$ are possible
 (the dimension $n_{IM}$ of $Q_0$ can be computed with the routine \texttt{IMdim(freqsReal,p)}). Finally,
\texttt{Q1N} and \texttt{Q2N} correspond to  the Galerkin approximations (compatible with \texttt{sysApprox}) of the parameters $Q_1\in \Lin(U_0,X)$ and $Q_2\in \Lin(X,Y_0)$ in~\citel{PauPha20}{Sec.~III.A}. They
can be chosen to correspond to the Galerkin approximations of $Q_1=q_1 I$ and $Q_2=q_2 I$ for some  $q_1,q_2>0$.

The model reduction dimension parameter \texttt{ROMorder} corresponds to $r$ in~\citel{PauPha20}{Sec.~III.A} and it determines the final reduced order dimension of the observer part of the controller. The model reduction step can be skipped completely by setting \texttt{ROMorder=NaN}. The size of the parameter should be determined to be sufficiently high so that the closed-loop system is exponentially stable. The result~\citel{PauPha20}{Thm.~III.1} guarantees that closed-loop stability for the original PDE plant and the reduced order controller is achieved if both the Galerkin approximation order $N$ and the model reduction parameter $r\geq N$ are sufficiently high, but (at the moment) there are no concrete lower bounds for these values. Typically, if the decay of the Hankel singular values of $(A^N,B^N,C^N)$ are sufficiently fast, it is possible to achive the closed-loop stability with a fairly small model reduction parameter $r$.

	\bigskip

  \item The ``Dual Observer Based Robust Controller'', based on references~\citel{Pau16a}{Sec. V},~\citel{Pau17b}{Sec. 4}. The closed-loop stability is achieved using a complementary controller structure which (formally) coincides with observer based stabilization of the dual of the closed-loop system.\\[1ex]
      Calling sequence for the construction:\\[-1ex]
     \begin{quotation}
       \texttt{DualObserverBasedRC(freqsReal,Sys,K2,L1,\\
	 \phantom{a}\hspace{3.7cm} IMstabtype,IMstabmarg)}
     \end{quotation}
     \medskip
     where \texttt{Sys} contains the parameters of the plant and \texttt{freqsReal} contains the frequencies $\set{\gw_k}_{k=0}^q$ of the signals $\yref(t)$ and $\wdist(t)$ in~\eqref{eq:yrefwdist}. The parameters \texttt{K2} and \texttt{L1} describe operators $K_2$ and $L_1$ such that $A+BK_2^\Lambda$ and $A+L_1\CL$ generate exponentially stable semigroups.

     Instead of the approach in~\cite{Pau16a}, the ``internal model'', i.e., the pair $(C_1,G_1)$, in the controller is stabilized either using LQR-based design (\texttt{IMstabtype = 'LQR'}) or alternatively using pole placement (\texttt{IMstabtype = 'poleplacement'}) with a predefined stability margin \texttt{IMstabmarg}. Note that the variable \texttt{IMstabmarg} only determines the stability margin of the internal model, and the stability margin of the closed-loop system also depends on the stability margins of the semigroups generated by $A+BK_2^\Lambda$ and $A+L_1\CL$.

	\bigskip
%\item \red{ADD: DUAL OBSERVER BASED ROM CONTROLLER}

  \item The ``Passive (Minimal) Robust Controller'' based on~\citel{RebWei03}{Thm. 1.2},~\citel{Pau19}{Sec. 5.1},~\cite{PauLeG22}. 
The controller can be used for \emph{impedance passive} linear systems which are either exponentially or strongly stable, or stabilizable with output feedback.
The controller design is based on forming a \keyterm{power preserving interconnection} between the passive system and the controller  to achieve closed-loop stability.\\[1ex]
      Calling sequence for the construction:\\[-1ex]
     \begin{quotation}
	 \texttt{PassiveRC(freqsReal,dimY,epsgain,Sys,Dc)}
     \end{quotation}
     \medskip
     where
     \texttt{freqsReal} contains the (real) frequencies $\set{\gw_k}_{k=0}^q$ of the signals $\yref(t)$ and $\wdist(t)$ in~\eqref{eq:yrefwdist}, \texttt{dimY} is the dimension of the output space $Y$ (i.e., the number of outputs of the system), and  \texttt{epsgain} is a scalar parameter $\eps>0$ which (linearly) scales the norms of $K$ and $G_2$.

%     In addition, \texttt{Pvals} is a $(q+1)\times p\times m$ array containing the values $P(i\gw_k)=\CL R(i\gw_k,A)B+D\in \C^{p\times m}$ of the transfer function of~\eqref{eq:plantintro} at the complex frequencies $\set{i\gw_k}_{k=0}^q$ of the reference and disturbance signals in~\eqref{eq:yrefwdist}.

The parameter \texttt{epsgain} can alternatively be a vector of length 2 providing minimal and maximal values for $\eps$. The controller construction has a naive functionality for finding an $\eps$ to optimize stability margin of the numerically approximated closed-loop system (simply by starting from the minimal value and increasing $\eps$ in steps). In this case, the parameter \texttt{Sys} (containing the parameters of the plant) is used for this optimization.

The optional parameter \texttt{Dc}, which is either $\dim Y\times \dim Y$-matrix or a scalar, is the feedthrough matrix $D_c$ 
for the controller. The closed-loop structure implies that a nonzero feedthrough term $D_c$ is equivalent to a 
 ``preliminary'' output feedback  $u(t)=D_c y(t)+ \tilde{u}(t)$ to the system (plus an additional disturbance term). For unstable systems the parameter \texttt{Dc} should be an output feedback matrix which stabilizes the system either exponentially or strongly, and in particular,
for exactly or approximately controllable unstable passive systems \texttt{Dc} can be any negative definite matrix.
If \texttt{Dc} is not given, the controller will by default have zero feedthrough.
If \texttt{Dc} is a scalar, the parameter is
interpreted as ``\texttt{Dc} times identity''.

It should be noted that the controller construction routine does not test passivity, and for a non-passive system the resulting closed-loop system will typically be unstable.

	\bigskip

     \COMMapproxRC{
     \item An ``approximate robust controller'' based on the reference~\cite{HumKur19} for finite-dimensional approximate control design for systems with infinite-dimensional output spaces.\\[1ex]
	 Calling sequence for the construction:\\[-1ex]
	   \begin{quotation}
	     \texttt{ApproximateRC(\dots)}
	   \end{quotation}
	 }
%  \item TODO: Implement Galerkin-ROM controllers for parabolic systems.
\end{itemize}

\subsection{Comments on the Controller Parameters}
\label{sec:ContrParameterComments}

In this section we make some remarks on the choices of the controller parameters.

\textbf{The gain parameter $\eps>0$ in }\texttt{LowGainRC}. 
The theory in~\cite{HamPoh00,RebWei03} guarantees that for a stable system $(A,B,C,D)$ there exists $\eps^\ast>0$ such that for any $0<\eps<\eps^\ast$ the closed-loop system is exponentially stable. The stability margin of the closed-loop system (which directly determines the convergence rate of the regulation error $e(t)$) can be optimized with a suitable choice of $\eps>0$. Finding such an optimal value of $\eps>0$ for a PDE system is a challenging task, but in numerical simulations one can use a naive approach of tracking the spectrum of the finite-dimensional closed-loop system matrix $A_e(\eps)$. This is the approach taken in the example cases in \RORname, though it should be noted that for general PDE systems there is no guarantee that the value $\eps>0$ obtained this way would optimize the closed-loop system for the original PDE system. 
In the example cases we are mainly interested in finding an $\eps>0$ which achieves a reasonable rate of convergence rate of the error $\norm{e(t)}$.

The gain in the passive robust controller \texttt{PassiveRC} can analogously be adjusted with a choice of a parameter $\eps>0$ to optimize the closed-loop stability margin.

\textbf{The transfer function values.} The controllers make use of the values  $P_{D_c}(i\gw_k)$ (or $P(i\gw_k)$)
%, $P_K(i\gw_k)$ and $P_L(i\gw_k)$ 
of the transfer functions associated to the original or stabilized versions of the PDE system.
Once the system \texttt{Sys} is defined, the simplest (and most tempting) approach is to compute these values as
\begin{quotation}
\texttt{
SysFB.C*((1i*wk*eye(dimX)-SysFB.A)$\setminus$SysFB.B) + SysFB.D
}
\end{quotation}
where the approximation \texttt{SysFB} of $(A^{D_c},B^{D_c},C^{D_c},D^{D_c})$ is computed from \texttt{Sys} as an output feedback with \texttt{SysFB = SysOutputFeedback(Sys,Dc)}, and \texttt{dimX=size(SysFB.A,1)}.
%In the Python version of \RORname\ The \RORname\ class \texttt{LinearSystem} has the necessary routines for computing these values based on the matrices \texttt{A}, \texttt{B}, \texttt{C}, and \texttt{D}. 
However, using the same approximation of the PDE for both controller design and simulation corresponds to essentially controlling the approximation \emph{as a finite-dimensional system}. If possible, to avoid unrealistically positive results, it is therefore better to use two different approximations for controller construction and simulation. This is especially the case if the validity of the approximation for the computation of the parameters can not be guaranteed with absolute certainty. However, there are of course cases, such as in Galerkin approximations of parabolic systems~\cite{Mor94}, where the values of the controller parameters can be shown to converge with the order of the approximation, and the above concerns are at least for the most part unnecessary.
In the Matlab version, the observer based controllers do not (at least currently) use the transfer functions for the construction of the controllers.
For simplicity, several built-in examples in \RORname\ still use \texttt{Sys} for computing \texttt{Pvals}, and the user is encouraged to replace these computations with other approximation methods!

For some special PDEs, such as 1D heat or wave equations with constant coefficients, the values $P(i\gw_k)$ may have explicit expressions, but these are very limited special cases. 
%But since the transfer functions of a PDE system can be obtained from solutions of a 
 For PDEs with spatially varying parameters there are powerful computational methods that can be used to determine $P(i\gw_k)$, such as the \textbf{Chebfun} package (\href{https://chebfun.org/}{https://chebfun.org/}) employed in \texttt{Heat1DCase1\_Main.m} in Section~\ref{sec:Heat1D2} (``Case 2'').



\section{PDE Models of the Example Cases}
\label{sec:PDEcases}

In this section we introduce the PDE models considered in the example cases and review their fundamental properties.
The considered reference and disturbance signals are in each case combinations of trigonometric functions of the form~\eqref{eq:yrefwdist} with a given set of frequencies. The precise choices of the signals can be seen from the main files of the examples. Similarly, the chosen initial states are visible from the source files, and in several files alternative initial states are provided (these can be used by uncommenting the corresponding lines of code).

\subsection{The 1D Heat Equations}

This collection of examples consists of 1D heat equations with spatially varying thermal diffusivity on $\Omega = [0,1]$ with different configurations of control inputs and measured outputs. Cases 1, 2, 4, and 5 consider control, disturbance, and observation on the boundary, and Case 3 considers a system with two distributed inputs and outputs. In general, any combination of the above types of inputs and outputs is possible. 
The main properties from the point of view of robust output regulation is whether or not the uncontrolled system is exponentially stable (the ``minimal'' Low-Gain Robust Controller can be used) or impedance passive (the Passive Robust Controller can be used).

In each of the cases, the spatial discretization of the PDE is completed using Finite Differences.

\medskip

\subsubsection*{Case 1: Neumann boundary input at $\xi = 0$, disturbance and output at $\xi = 1$}
~\\[-1ex]

  \noindent Main file name: \texttt{Heat1DCase1\_Main.m}

\medskip

The model on $\Omega = [0,1]$ is
\eq{
  \pd{x}{t}(\xi,t) &=  \pdb{\xi}(c(\xi)\pd{x}{\xi})(\xi,t), \qquad x(\xi,0)=x_0(\xi) \\
      -\pd{x}{\xi}(0,t) &= u(t), \qquad 
      \pd{x}{\xi}(1,t) = \wdist(t), \\
      y(t) &= x(1,t),
    }
    where $c(\cdot)\geq c_0>0$ is the spatially varying \textit{thermal diffusivity} of the material.
    The uncontrolled system is unstable due to the eigenvalue $\gl=0$. 
%    Since the control input $u(t)$ and output $y(t)$ are not collocated, the system can not be 
The example uses the ``Observer Based Robust Controller'' and ``Dual Observer Based Robust Controller'' to achieve robust output tracking and disturbance rejection.

\medskip

\subsubsection*{Case 2: Input, output, and disturbance at $\xi = 0$, Dirichlet at $\xi = 1$}
\label{sec:Heat1D2}
~\\[-1ex]

  \noindent Main file name: \texttt{Heat1DCase2\_Main.m}

\medskip

The model on $\Omega = [0,1]$ is
\eq{
  \pd{x}{t}(\xi,t) &=  \pdb{\xi}(c(\xi)\pd{x}{\xi})(\xi,t), \qquad x(\xi,0)=x_0(\xi) \\
      -\pd{x}{\xi}(0,t) &= u(t)+\wdist(t), \qquad 
      x(1,t) = 0, \\
      y(t) &= x(0,t),
    }
    where $c(\cdot)\geq c_0>0$ is the spatially varying thermal diffusivity of the material.
The uncontrolled system is exponentially stable due to the homogeneous Dirichlet boundary condition at $\xi = 1$, and therefore the Low-Gain Robust Controller can be used. The system is also impedance passive since the control input and measured output are collocated,  and because of this the robust output regulation problem can alternatively be solved using the Passive Robust Controller.
%    Since the control input $u(t)$ and output $y(t)$ are not collocated, the system can not be 

In the example, the construction of the Low-Gain Robust Controller employs the \textbf{Chebfun} Matlab package in computing the required transfer function values $P(i\gw_k) = \CL R(i\gw_k,A)B+D$. This can be done by noting that for each $k$ the desired transfer function value is exactly $P(i\gw_k)=\hat{x}(0)$, where $\hat{x}(\cdot)$ is the (unique) solution of the boundary value problem
\eq{
  i\gw_k\hat{x}(\xi) &-  \pdb{\xi}(c(\xi)\pd{\hat{x}}{\xi})(\xi)=0\\
      -\pd{\hat{x}}{\xi}(0) &= 1, \qquad 
      \hat{x}(1) = 0.
}
\textbf{Chebfun} excels in solving such equations with high accuracy, and therefore the use of this package yields excellent estimates of $P(i\gw_k)$ for the original system. 

\medskip

\subsubsection*{Case 3: Distributed input and output, boundary disturbance at $\xi = 0$, Dirichlet boundary condition at $\xi = 1$}
~\\[-1ex]

  \noindent Main file name: \texttt{Heat1DCase3\_Main.m}

\medskip

The model on $\Omega = [0,1]$ is
\eq{
  \pd{x}{t}(\xi,t) &=  \pdb{\xi}(c(\xi)\pd{x}{\xi})(\xi,t)+b_1(\xi)u_1(t) + b_2(\xi)u_2(t)  \\
      -\pd{x}{\xi}(0,t) &= \wdist(t), \qquad 
      x(1,t) = 0,  \quad x(\xi,0)=x_0(\xi),\\
      y(t) &= \int_0^1\pmat{c_1(\xi)x(\xi,t)\\c_2(\xi)x(\xi,t)}d\xi\in \R^2
    }
    where $c(\cdot)\geq c_0>0$ is the spatially varying thermal diffusivity of the material and
%    $b_1(\xi)=10\chi_{[.3,.6]}(\xi)$ and $b_2(\xi)=10\chi_{[.6,.7]}(\xi)$ and 
\eq{
  b_1(\xi)&=10\chi_{[.3,.6]}(\xi) , \quad
   b_2(\xi)=10\chi_{[.6,.7]}(\xi), \\
  c_1(\xi)&=10\chi_{[.1,.2]}(\xi), \quad c_2(\xi)=10\chi_{[.8,.9]}(\xi) .
}
    Here $\chi_{[a,b]}(\cdot)$ is the characteristic function on the interval $[a,b]\subset [0,1]$, and thus the control inputs act on the intervals $[0.3,0.4]$ and $[0.6,0.7]$, and the outputs measure the average temperatures on the intervals $[0.1,0.2]$ and $[0.8,0.9]$ (alternative input and output locations can be set with parameters for the routine \texttt{ConstrHeat1DCase3}).
The uncontrolled system is stable due to the homogeneous Dirichlet boundary condition at $\xi = 1$. The default controller used in this example is the Reduced Order Observer Based Robust Controller in \texttt{ObserverBasedROMRC}.

Figure~\ref{fig:1Dheat3} shows example results of the simulations including plots of the outputs and reference signals, norm of the regulation error, computed control signals, and the state of the controlled system as a function of $\xi$ and $t$.

\begin{figure}[h!]
  \begin{minipage}{0.46\linewidth}
    \includegraphics[width=.95\linewidth]{H1D3outputs.pdf}
  \end{minipage}
  \hfill
  \begin{minipage}{0.52\linewidth}
    \includegraphics[width=\linewidth]{H1d3surf.png}
  \end{minipage}
%  \includegraphics{}
\caption{Example output of the 1D Heat equation (``Case 3'').}
  \label{fig:1Dheat3}
\end{figure}

%The examples consider one-dimensional boundary controlled heat equations on $\Omega = [0,1]$
%  \begin{subequations}
%    \label{eq:heatex1D}
%    \eqn{
%      x_t(\xi,t) &=  x_{\xi\xi}(\xi,t), \qquad x(\xi,0)=x_0(\xi) \\
%      \pd{x}{n}(\xi,t)\vert_{\Gamma_1} &= u(t), \qquad 
%      \pd{x}{n}(\xi,t)\vert_{\Gamma_2} = \wdist(t), \qquad
%      \pd{x}{n}(\xi,t)\vert_{\Gamma_0} = 0\\
%      y(t) &= \int_{\Gamma_1}x(\xi,t)d\xi.
%    }
%  \end{subequations}
%%  Here the parts $\Gamma_0$, $\Gamma_1$, and $\Gamma_2$ of the boundary $\partial \Omega$ are defined so that
%%  $\Gamma_1 = \setm{\xi=(0,\xi_2)}{0\leq \xi_2\leq 1}$,
%%  $\Gamma_2 = \setm{\xi=(\xi_1,1)}{1/2\leq \xi_1\leq 1}$, 
%%  $\Gamma_0 = \partial \Omega \setminus (\Gamma_1 \cup \Gamma_2)$. By~\cite[Cor. 2]{ByrGil02} the heat equation defines a regular linear system with feedthrough $D=0$. The system is passive,
%%
%Cases:
%\begin{itemize}
%  \item Case 1: $B$ at $x=0$, $B_d$ and $C$ at $x=1$
%  \item Case 2: $B$, $B_d$ and $C$ at $x=0$, Dir at $x=1$
%  \item Case 3: $B_d$ at $x=0$, $B$ and $C$ distributed $2\times 2$
%\end{itemize}
%%IF only one case:
%%$B$ at $x=0$, $B_d$ at $x=1$, $y(t)$ at $x=1$, $y_m$ (if used) at $x=0$.
%%
%%Cases for inputs:
%%\begin{itemize}
%%  \item 1 inputs
%%    \begin{itemize}
%%      \item $B$ at $x=0$ and $x=1$, 
%%    \end{itemize}
%%  \item 1 inputs
%%    \begin{itemize}
%%      \item $B$ at $x=0$ or $x=1$
%%    \end{itemize}
%%\end{itemize}

\subsubsection*{Case 4: Dirichlet boundary input at $\xi=1$, boundary disturbance and measurement at $\xi = 0$}
\label{sec:Heat1D3}
~\\[-1ex]

  \noindent Main file name: \texttt{Heat1DCase4\_Main.m}

\medskip

The model on $\Omega = [0,1]$ is
\eq{
  \pd{x}{t}(\xi,t) &=  \pdb{\xi}(c(\xi)\pd{x}{\xi})(\xi,t)  \\
      -\pd{x}{\xi}(0,t) &= \wdist(t), \qquad 
      x(1,t) = u(t),  \qquad x(\xi,0)=x_0(\xi),\\
      y(t) &= x(0,t)
    }
    where $c(\cdot)\geq c_0>0$ is the spatially varying thermal diffusivity of the material.
%    $b_1(\xi)=10\chi_{[.3,.6]}(\xi)$ and $b_2(\xi)=10\chi_{[.6,.7]}(\xi)$ and 
The uncontrolled system is stable because of the Dirichlet-type boundary condition at $\xi = 1$. The system, however, does not give rise to a wellposed or regular linear system on the natural state space $X=\Lp[2](0,1)$, but only on $X=H^{-1}(0,1)$.
It does, however, give rise to a well-defined Boundary Control System~\cite{Sal87a,CheMor03,MalSta06} on $X=\Lp[2](0,1)$, and the use of the Low-Gain Robust Controller (\texttt{LowGainRC}) is justified by the theory presented in~\cite{HumPau18,HumKur19}.

Other controller designs can be used in this simulation example, but as the authors of the software are not
 familiar with the details on approximation of regular linear systems defined on $H^{-1}(0,1)$, 
 this part of the simulation example 
should be considered to be for experimentation purposes only. That is, \emph{use at your own risk!} \smiley{}

\medskip

\subsubsection*{Case 5: Neumann boundary inputs and input disturbances at $\xi = 0$ and $\xi=1$,  and with collocated outputs}
~\\[-1ex]

  \noindent Main file name: \texttt{Heat1DCase5\_Main.m}

\medskip

The model defined on
 $\Omega = [0,1]$ is similar to ``Case 1'', but now has two Neumann boundary control inputs and collocated outputs (at $\xi=0$ and $\xi=1$), i.e.,
\eq{
  \pd{x}{t}(\xi,t) &=  \pdb{\xi}(c(\xi)\pd{x}{\xi})(\xi,t) + b_d(\xi)\wdk[3](t), \qquad x(\xi,0)=x_0(\xi) \\
      -\pd{x}{\xi}(0,t) &= u_1(t) + \wdk[1](t), \qquad 
      \pd{x}{\xi}(1,t) = u_2(t)+\wdk[2](t), \\
      y(t) &= (x(0,t),x(1,t))^T
    }
    where $c(\cdot)\geq c_0>0$ is the spatially varying \textit{thermal diffusivity} of the material.
The third disturbance input acts through the input profile $b_d(\cdot)$ (defined by \texttt{Bd\_profile} in the code).
    The uncontrolled system is unstable due to the eigenvalue $\gl=0$. 
The system is impedance passive (due to the collocated inputs and outputs) and  it can be stabilized with negative output feedback.
For controller design we can use the Passive Robust Controller (with a negative definite feedthrough term), or alternatively
either the Observer Based Robust Controller or Dual Observer Based Robust Controller.

\subsection{The 2D Heat Equations on Rectangular Domains}

These examples consider two-dimensional heat equations on $\Omega = [0,1]\times [0,1]$ with boundary input and output and boundary disturbances. The inputs and outputs act in an averaged sense on parts of the boundaries.
The reference and disturbance signals are again of the form~\eqref{eq:yrefwdist} and can be seen from the main files of the simulations.

\medskip

\subsubsection*{Case 1: Collocated input and output, a prestabilized system}
~\\[-1ex]


  \noindent Main file name: \texttt{Heat2DCase1\_Main.m}

\medskip

This example is taken from the article~\citel{Pau16a}{Sec. VII}.
The system on $\Omega = [0,1]\times [0,1]$ with two inputs $u(t)=(u_1(t),u_2(t))^T$ and two outputs $y(t)=(y_1(t),y_2(t))^T$ is determined by
%  \begin{subequations}
%    \label{eq:heatex}
    \eq{
      x_t(\xi,t) &= \Delta x(\xi,t), \qquad x(\xi,0)=x_0(\xi) \\
      \pd{x}{n}(\xi,t)\vert_{\Gamma_1} &= u_1(t), \qquad 
      \pd{x}{n}(\xi,t)\vert_{\Gamma_2} = u_2(t), \qquad
      \pd{x}{n}(\xi,t)\vert_{\Gamma_0} = 0\\
      y_1(t) &= \int_{\Gamma_1}x(\xi,t)d\xi, \qquad
      y_2(t) = \int_{\Gamma_2}x(\xi,t)d\xi.
    }
%  \end{subequations}
  Here the parts $\Gamma_0$, $\Gamma_1$, and $\Gamma_2$ of the boundary $\partial \Omega$ are defined so that
  $\Gamma_1 = \setm{\xi=(\xi_1,0)}{0\leq \xi_1\leq 1/2}$,
  $\Gamma_2 = \setm{\xi=(\xi_1,1)}{1/2\leq \xi_1\leq 1}$, 
  $\Gamma_0 = \partial \Omega \setminus (\Gamma_1 \cup \Gamma_2)$. By~\cite[Cor. 2]{ByrGil02} the heat equation defines a regular linear system with feedthrough $D=0$. The system is also impedance passive due to the fact that the inputs $u(t)$ and the outputs $y(t) $ are collocated.
%  \eq{
%    P(\gl) = \frac{\coth(\sqrt{\gl})}{\sqrt{\gl}}, \qquad \gl\in \overline{\C_+}\setminus \set{0},
%  }
%and $\abs{P(i\gw)\inv}=O(\abs{\sqrt{\gw}})$ for $\gw\in\R$ with large $\abs{\gw}$. 
The uncontrolled system is unstable due to the eigenvalue $\gl=0$, but it can be stabilized exponentially with negative output feedback $u(t) = -\kappa y(t)$ for any $\kappa>0$.
In this example the constructed system is already pre-stabilized with $\kappa = 1$ (see ``Case 3'' for a version without prestabilization).

In the simulations, the system is approximated using the eigenmodes of the Laplacian. The system can be controlled either with the minimal Low-Gain Robust Controller (\texttt{LowGainRC}) or the Passive Controller (\texttt{PassiveRC})  (with pre-stabilizing negative output feedback), or with one of the Observer Based Robust Controllers (\texttt{ObserverBasedRC} or \texttt{DualObserverBasedRC}).


\medskip

\subsubsection*{Case 2: Non-collocated input and output}
~\\[-1ex]

  \noindent Main file name: \texttt{Heat2DCase2\_Main.m}

\medskip

The model is similar to ``Case 1'', but the inputs and outputs of the system are not collocated. Instead, the control input, the disturbance input, and the measured output act on distinct parts of the boundary of the 
rectangle $\Omega = [0,1]\times [0,1]$. The PDE system is defined as
%  \begin{subequations}
%    \label{eq:heatex}
    \eq{
      x_t(\xi,t) &= \Delta x(\xi,t), \qquad x(\xi,0)=x_0(\xi) \\
      \pd{x}{n}(\xi,t)\vert_{\Gamma_1} &= u(t), \qquad 
      \pd{x}{n}(\xi,t)\vert_{\Gamma_3} = \wdist(t), \qquad
      \pd{x}{n}(\xi,t)\vert_{\Gamma_0} = 0\\
      y(t) &= \int_{\Gamma_2}x(\xi,t)d\xi.
    }
%  \end{subequations}
  Here the parts $\Gamma_0$, $\Gamma_1$, $\Gamma_2$, and $\Gamma_3$ of the boundary $\partial \Omega$ are defined so that
  $\Gamma_1 = \setm{\xi=(0,\xi_2)}{0\leq \xi_2\leq 1}$,
  $\Gamma_2 = \setm{\xi=(\xi_1,1)}{0\leq \xi_1\leq 1}$, 
  $\Gamma_3 = \setm{\xi=(\xi_1,0)}{0\leq \xi_1\leq 1/2}$, 
  $\Gamma_0 = \partial \Omega \setminus (\Gamma_1 \cup \Gamma_2\cup \Gamma_3)$. By~\cite[Cor. 2]{ByrGil02} the heat equation defines a regular linear system with feedthrough $D=0$.
The uncontrolled system is unstable due to the eigenvalue $\gl=0$. 

Since the system is unstable, the primary choices of the controllers are the Observer Based Robust Controller (\texttt{ObserverBasedRC}) and Dual Observer Based Robust Controller (\texttt{DualObserverBasedRC}). However, since the single unstable eigenvalue can be stabilized also by negative output feedback of the form $u(t)=-\kappa y(t)$, it is also possible to use the Low-Gain Robust Controller (\texttt{LowGainRC}) with a negative definite feedthrough term $D_c = -\kappa I$ (given as the optional parameter \texttt{Dc}). The Low-Gain Robust Controller is by default commented out in the code in \texttt{Heat2DCase2\_Main.m}.

In the simulations, the system is approximated using Finite Differences with a uniform grid. 


\begin{figure}[h!]
  \begin{minipage}{0.46\linewidth}
    \includegraphics[width=0.95\linewidth]{H2D2outputs.pdf}
  \end{minipage}
  \hfill
  \begin{minipage}{0.52\linewidth}
    \includegraphics[width=0.9\linewidth]{H2D2surf.png}
  \end{minipage}
%  \includegraphics{}
\caption{Example output of the 2D Heat equation (``Case 2'').}
  \label{fig:2Dheat2}
\end{figure}

\medskip

\subsubsection*{Case 3: Collocated input and output}
~\\[-1ex]


  \noindent Main file name: \texttt{Heat2DCase3\_Main.m}

\medskip

The example is the same as ``Case 1'', but does not include prestabilization of the unstable eigenvalue at $\gl = 0$. Since the system is impedance passive, the controller design can be completed using the Passive Robust Controller (\texttt{PassiveRC}), but the controller requires the (otherwise optional) feedthrough term, which should be a negative definite $2\times 2$ matrix. Alternatively, the controller design can be completed using either the Observer Based Robust Controller (\texttt{ObserverBasedRC}) or the Dual Observer Based Robust Controller (\texttt{DualObserverBasedRC}). In these cases, the required state feedback operator $K_{21}$ and and output injection operator $L$ for the exponential stabilization of the pairs $(A,B)$ and $(\CL,A)$ can be designed using collocated design, i.e., by choosing these as  $K_{21}=-\kappa_K B^\ast$ and $L=-\kappa_L C^\ast$. Note that in the article~\cite{Pau16a} the stabilizing operators were assumed to be bounded, but the controller design can also be constructed with \emph{unbounded} operators due to the more general results in~\cite{Pau17b}.

\subsection{The 1D Wave Equations}

In these examples we consider  one-dimen\-sional undamped and damped wave equations with control and observation at the boundaries and inside the domain. 

\medskip

\subsubsection*{Case 1: Non-collocated boundary input and output, boundary disturbance near the output}
~\\[-1ex]

  \noindent Main file name: \texttt{Wave1DCase1\_Main.m}
  
  \medskip

The model on $\Omega = [0,1]$ is
\eq{
  x_{tt}(\xi,t) &=  x_{\xi\xi}(\xi,t), \qquad x(\xi,0)=x_0(\xi), \quad x_t(\xi,0)=x_1(\xi)\\
      -\pd{x}{\xi}(0,t) &= \wdist(t), \qquad 
      \pd{x}{\xi}(1,t) = u(t), \\
      y(t) &= x_t(0,t), \qquad y_m(t) = \int_0^1 x(\xi,t)dt
    }
    The uncontrolled system is unstable due to lack of damping. It also cannot be stabilized with output feedback due to the non-collocated configuration of the inputs and outputs.
    The goal is to achieve tracking of the output $y(t)$. The additional measured output $y_m(t)$ is required to achieve closed-loop stability due to the fact that the system is not exponentially detectable with output $y(t)$ (because of the unobservability of the eigenvalue $\gl=0$).

    In the example case, the second output $y_m(t)$ is used to prestabilize eigenvalue $\gl=0$ of the system with preliminary output feedback of the form $u(t)=-\kappa_m y_m(t)+\tilde{u}(t)$ (where $\tilde{u}(t)$ is the new input of the system). There are also other (and better) ways to handle the situation, and these will be implemented in later versions of this example. 
    The pairs $(A,B)$ and $(C,A)$ are stabilized using collocated designs, i.e., we choose $K=-\kappa_K B^\ast$ and $L=-\kappa_L C^\ast$ to stabilize the pairs $A+BK$ and $A+LC$.
    The main file contains the pre-stabilization gain $K_m>0$ and the gains $\kappa_K,\kappa_L>0$ as design parameters.

    The example considers output tracking of the velocity $x_t(0,t)$ to arbitrary 2-periodic reference signals. This is achieved by including  frequencies of the form $k\pi$ for $k\in \List{q}$ in the internal model.  The reference signal is defined by defining its profile over one period in the  variable '\texttt{yref1per}'. Note that it is not necessary to compute the amplitudes of the frequency components of $\yref(t)$ (which would be equivalent to finding the Fourier series  expansion of the reference signal).

In the simulations the system is approximated using the orthonormal eigenfunctions of the undamped wave operator.
%Figure~\ref{fig:1Dwave1} shows example results of the simulation for a smooth periodic reference signal.
% for two different periodic reference signals --- a nonsmooth triangle signal and signal consisting of semicircles.


%\subsubsection*{Example output}
%
%Figure~\ref{fig:1Dwave1} shows example output with the following parameters:  
%\begin{itemize}
%  \item Controller: Observer-based robust controller, 'LQR' stabilization with stability margin $=1$
%  \item System stabilization: $\kappa_m = .3$, $\kappa=.9$, $\ell = .8$.
%  \item Signals: $\yref(t) = -2\cos(\pi t/2)+\sin(\pi t/2)$, $\wdist(t) = \sin(4\pi t)$ (frequencies $\set{\gw_k}_k=\set{\pi/2,\pi,2\pi,3\pi,4\pi}$), 
%  \item Initial state: $x_0(\xi)=30\xi^2(1-\xi)^2-1$, $x_1(\xi)\equiv 0$, controller initial state $=0$
%\end{itemize}


%\begin{itemize}
%  \item Boundary damping, exponentially stable system, spectral approximation.
%\end{itemize}

\medskip

\subsubsection*{Case 2: Collocated distributed input and output}
~\\[-1ex]

  \noindent Main file name: \texttt{Wave1DCase2\_Main.m}

  \medskip

The model on $\Omega = [0,1]$ is
\eq{
  x_{tt}(\xi,t) &=  x_{\xi\xi}(\xi,t) + b(\xi)u(t) + b_d(\xi)\wdist(t)\\
      x(0,t) &= 0, \qquad 
      x(1,t) = 0 \\
x(\xi,0)&=x_0(\xi), \quad x_t(\xi,0)=x_1(\xi)\\
      y(t) &=  \int_0^1 b(\xi)x(\xi,t)dt
    }
    for some $b(\cdot),b_d(\cdot)\in \Lp[2](0,1;\R)$.
    The uncontrolled system is unstable due to the lack of damping. Since the input and output are distributed, it is also not exponentially stabilizable or detectable, but instead it is only strongly (or polynomially~\cite{BorTom10}) stabilizable provided that $\iprod{b(\cdot)}{\sin(k\pi \cdot)}_{\Lp[2]}\neq 0$ for all $k\in\N$.
    Because of this, it is not possible to use the Low-Gain Robust Controller, and the two observer based controller designs are not guaranteed to achieve closed-loop stability. However, since the system is impedance passive, the Passive Robust Controller (\texttt{PassiveRC}) can be used in achieving robust output regulation even in the absence of exponential stability as shown in~\citel{Pau19}{Sec. 5.1}.
Due to the sub-exponential closed-loop stability, the regulation error does not converge with any uniform convergence rate, but instead the rate depends on the initial state of the system. 

In the simulations the system is approximated using the orthonormal eigenfunctions of the undamped wave operator.
Figure~\ref{fig:1Dwave2} shows example results of the simulation for a smooth periodic reference signal with two frequencies $\pi$ and $2\pi$.

\begin{figure}[h!]
  \centering
  \begin{minipage}{0.43\linewidth}
    \begin{flushleft}
      \includegraphics[width=0.95\linewidth]{W1D2outputs.pdf}
    \end{flushleft}
  \end{minipage}
  \begin{minipage}{0.55\linewidth}
    \begin{flushright}
      \includegraphics[width=\linewidth]{W1D2profile.png}
    \end{flushright}
  \end{minipage}

    \caption{Example outputs of the periodic tracking for the 1D wave equation (``Case 2'').}
  \label{fig:1Dwave2}
\end{figure}

\medskip


\subsection{The 2D Wave Equation on an Annulus}
~\\[-1ex]

  \noindent Main file name: \texttt{Wave2DCase1\_Main.m}

  \medskip

This simulation example of a boundary controlled 2D wave equation
  is taken from the article~\cite{HumKur19}. In particular, 
  $\Omega\subset\R^n$ is a bounded domain (an open connected set) with a Lipschitz-continuous boundary $\partial\Omega$ split into two parts $\Gamma_0,\Gamma_1$ such that $\overline{\Gamma_0}\cup\overline{\Gamma_1}=\partial\Omega$, $\Gamma_0\cap\Gamma_1=\emptyset$, and $\partial\Gamma_0,\partial\Gamma_1$ both have surface measure zero. The wave equation is of the form
  %\begin{equation}\label{eq:waveintro}
  %  \left\{
  %    \begin{aligned}
  \eq{
    \rho(\zeta)\frac{\partial^2 w}{\partial t^2} (\zeta,t) &= \nabla\cdot \big(T(\zeta)\,\nabla w\,(\zeta,t)\big), \quad \zeta\in\Omega,\\
    u (\zeta,t) &= \nu\cdot T(\zeta)\,\nabla w(\zeta,t), \quad \zeta\in\Gamma_1,\\
    y (\zeta,t) &= \frac{\partial w}{\partial t}(\zeta,t), \qquad \zeta\in\Gamma_1,\\
    0 &= \frac{\partial w}{\partial t}(\zeta,t),\qquad \zeta\in\Gamma_0,~t>0 \\
    z(\cdot,0) &= w_0,\qquad \frac{\partial z}{\partial t}(\cdot,0)=w_1,
    %\end{aligned}\right.
  }
  %\end{equation}
  where $w(\zeta,t)$ is the displacement from the equilibrium at the point $\zeta\in\Omega$ and time $t\geq0$, $\rho(\cdot)$ is the mass density, $T^*(\cdot)=T(\cdot)\in L^2(\Omega;\R^n)$ is Young's modulus and $\nu\in L^\infty(\partial\Omega;\R^n)$ is the unit outward normal at $\partial\Omega$. The functions $\rho(\cdot)$ and $T(\cdot)$ are essentially bounded from both above and below away from zero. In the equation, the boundary input and boundary measurement are collocated.

  In particular, we consider the wave equation on an annulus 
  $\Omega := \set{\zeta \in \mathbb{R}^2 \mid 1 < \|\zeta\| < 2}$. 
  We choose $\partial \Omega = \Gamma_0 \cup \Gamma_1$ where $\Gamma_0 = \set{\zeta \in \partial\Omega \mid \|\zeta\| = 1}$ and $\Gamma_1 = \set{\zeta \in \partial\Omega \mid \|\zeta\| = 2}$ so that the control and the measurement are on the outer boundary of the annulus.

  The output space is infinite-dimensional,  $Y :=  \setm{h\in H^{1/2}(\partial\Omega)}{ h\vert_{\Gamma_0}=0}$ which is continuously and densely embedded into $L^2(\Gamma_1)$~\citel{TucWei09book}{Thm.~13.6.10}. 
The initial reference and disturbance signals in the example are given by
  \eq{
    y_{ref}(\theta, t)&  = \frac{1}{2\pi^2}(\pi - \theta)^2\sin(\pi t) +
    \frac{1}{2}\sin\left(\frac{\theta}{2}\right)\cos(2\pi t) \\
    w(\theta, t) & = \cos(\theta)\sin(2\pi t) + \sin(\theta)\sin(\pi t).
  }
  The real frequencies are then $\gw_1=\pi$, $ \gw_2=2\pi$.
Because of of the technical challenges arising from the infinite-dimensional input and outputs spaces of the model, the example is not (at the moment) written completely in ``\RORname\ style''. In particular, the closed-loop construction is based on expressing the signals $\yref(t)$ and $\wdist(t)$ as outputs of an \emph{exosystem}, and also the controller is constructed by hand in the main file of the simulation example. The controller is the ``Approximate internal model based controller'' introduced in the reference~\cite{HumKur19}, and it is not (yet) implemented in \RORname\ as a general controller construction routine.

  The numerical approximation in the example is done using the spectral method based on the eigenvalues and eigenfunctions of the undamped wave equation on the annulus. The approximate controller includes a negative definite feedthrough term $D_c$ which corresponds to pre-stabilizing the system with negative output feedback. 
  %The initial choice for the controller is the 
  %The system is passive

\begin{figure}[h!]
  \centering
  \begin{minipage}{0.48\linewidth}
    \begin{flushleft}
      \includegraphics[width=0.95\linewidth]{W2D1error.pdf}

      \includegraphics[width=0.95\linewidth]{W2D1output.png}
    \end{flushleft}
  \end{minipage}
  \begin{minipage}{0.48\linewidth}
    \begin{flushright}
      \includegraphics[width=0.95\linewidth]{W2D1profile.png}
    \end{flushright}
  \end{minipage}

    \caption{Example outputs of the approximate tracking for the 2D wave equation (``Case 1'').}
  \label{fig:2Dwave1}
\end{figure}

%\COMMapproxRC{
%  The \keyterm{approximate robust controller} is designed based on finite-dimensional Fourier subspaces
%  %\eq{
%  %  Y_N := \operatorname{span}\left(e^{ik\cdot}\right)_{k=-N}^N
%  %}
%  of $Y$, and the corresponding orthonormal projection $P_N$ onto $Y_N$.
%  %
%  %as the sequence $\displaystyle \left(\frac{1}{\sqrt{2\pi}}e^{ik\cdot}\right)$ is an orthonormal basis of $L^2([-\pi, \pi])$. The projection $P_N$ from $Y$ onto $Y_N$ is then given by
%  %\begin{equation}
%  %  \label{eq:PN}
%  %	P_N y := \frac{1}{2\pi}\sum_{k=-N}^N \left\langle y, e^{ik\cdot} \right\rangle_{L^2([-\pi, \pi])} e^{ik\cdot}.  
%  %\end{equation}
%
%  The initial reference and disturbance signals in the example are given by
%  \eq{
%    y_{ref}(\theta, t)&  = \frac{1}{2\pi^2}(\pi - \theta)^2\sin(\pi t) +
%    \frac{1}{2}\sin\left(\frac{\theta}{2}\right)\cos(2\pi t) \\
%    w(\theta, t) & = \cos(\theta)\sin(2\pi t) + \sin(\theta)\sin(\pi t).
%  }
%  The real frequencies are then $\gw_1=\pi$, $ \gw_2=2\pi$.
%
%  The numerical approximation in the example is done using the spectral method based on the eigenvalues and eigenfunctions of the undamped wave equation on the annulus. The approximate controller includes the stabilizing term $D_c$ which corresponds to pre-stabilizing the system with negative output feedback. 
%  %The initial choice for the controller is the 
%  %The system is passive
%}

\subsection{The Controlled Beam Equations}
\label{sec:ControlledBeams}


The following example study controller design for controlled beam equation models.


\medskip

\subsubsection*{Example: An Euler--Bernoulli Beam with Kelvin--Voigt Damping}
\label{sec:BeamKV}
~\\[-1ex]

\noindent Main file name: \texttt{BeamKelvinVoigt\_Main.m}

\medskip

The simulation example is taken from the conference article~\cite{PauPhaMTNS20}.
The goal is to construct a \emph{finite-dimensional} and low-order error feedback controller for output tracking and disturbance rejection of an Euler--Bernoulli beam equation with Kelvin-Voigt damping on $\Omega=(-1,1)$~\citel{ItoMor98}{Sec.~3},
%\begin{subequations}
%    \label{eq:EBmodel}
  \eq{
%    \frac{\partial^2 v}{\partial t^2}(\xi,t)  &+  \frac{\partial^2 }{\partial \xi^2}\left( \ga \frac{\partial^2 v}{\partial \xi^2}(\xi,t) + \gb \frac{\partial^3 v}{\partial \xi^2 \partial t}(\xi,t)  \right)
& v_{tt}(\xi,t)
+\left( EI v_{\xi\xi}+d_{KV}I v_{\xi\xi t} \right)_{\xi\xi}(\xi,t)  + d_v v_t(\xi,t)\\
%+ EI v_{\xi\xi\xi\xi}(\xi,t)+d_{KV} v_{\xi\xi\xi\xi t} (\xi,t) \\
&\hspace{2cm} = 
%B_u(\xi)u(t)
b_1(\xi)u_1(t)+b_2(\xi)u_2(t)
+ B_{d0}(\xi) \wdist(t) 
    \\
    &\qquad v(-1,t) = v_\xi(-1,t)= 0,
    \\
  &\qquad  v(1,t)=v_\xi(1,t)=0\\
%    &&\frac{\partial v}{\partial \xi} (0,t) = 0, \\ 
%    &\quad + \gg \frac{\partial v}{\partial t}(\xi,t)  =  B_0u(t) + B_{d0}(\xi) \wdist(t) ,\\
    &\qquad v(\xi,0)=v_0(\xi), \qquad v_t(\xi,0)=v_1(\xi),\\
    &\qquad y(t)= (v(\xi_1,t),v(\xi_2,t))^T.
%    y_1(t)&=
%%    \int_{-1}^1 v(\cdot,t)c_1^1(\xi)d\xi + 
%%    \int_{-1}^1 v_t(\cdot,t)c_2^1(\xi)d\xi \\
%    y_2(t)&=
%    \int_{-1}^1 v(\cdot,t)c_1^2(\xi)d\xi + 
%    \int_{-1}^1 v_t(\cdot,t)c_2^2(\xi)d\xi 
%%    +C_2\dot{v}(\cdot,t)
  }
%\end{subequations}
The parameters $E>0$ and $I>0$ are the (constant) elastic modulus and 
the second moment of area, respectively,
%$EI>0$ is the constant flexural rigidity of the beam
and $d_{KV}>0$ and $d_v\geq 0$ are the damping coefficients associated to the Kelvin--Voigt damping and viscous damping, respectively.
The beam is assumed to have constant density $\rho=1$.

The system has two control inputs $u(t)=(u_1(t),u_2(t))^T$ and two measured outputs $y(t)=(y_1(t),y_2(t))^T$.
The outputs are point observations of the deflection of the beam at distinct points $\xi_1,\xi_2\in(-1,1)$.
The input profiles
% $b_1(\cdot),b_2(\cdot)\in \Lp[2](-1,1;\R)$
$b_1(\cdot),b_2(\cdot)\in C^1(-1,1;\R)$
are fixed input profiles satisfying $b_j(\pm 1)=b_j'(\pm 1)=0$, $j=1,2$, 
and the disturbance input term has the form $B_{d0}(\xi)\wdist(t) = \sum_{k=1}^{n_d}b_{dk}(\xi)\wdist^k(t)$ for $\wdist(t)=(\wdist^k(t))_{k=1}^{n_d}$ and for some fixed but unknown profile functions $b_{dk}(\cdot)\in C^1(-1,1;\R)$ with $b_{dk}(\pm 1)=b_{dk}'(\pm 1)=0$ for $k\in \List{n_d}$.



In the simulation example the physical parameters of the model are 
\eq{
\rho=1, \quad
  \quad
E=10, \quad
I=1, \quad
d_{KV}=0.01, \quad
d_v=0.4.
}
The point observations are located at $\xi_1=-0.6$ and $\xi_2=0.3$, and the input profiles are
% Input profile functions
\eq{
b_1(\xi) = \frac{1}{3}(\xi+1)^2(1-\xi)^6, \quad \mbox{and} \quad
b_2(\xi) =  \frac{1}{3}(\xi+1)^6(1-\xi)^2.
}
The system has a
single disturbance with a disturbance input profile 
$b_{d1}(\xi) = (\xi+1)^2(1-\xi)^2$.


Because of the Kelvin--Voigt damping, the controlled PDE model satisfies the assumptions required for Reduced Order Internal Model Based Controller design in~\cite{PauPha20}.
In this example, the PDE model is approximated using a spectral Galerkin method described in~\cite{She95}. This approximation scheme is used for two purposes, first of all to design the Reduced Order Observer Based Robust Controller with the routine \texttt{ObserverBasedROMRC}, and in addition to approximate the controlled PDE system in the closed-loop simulation (with a higher order approximation).

With the chosen parameters of the beam model the controlled PDE system is in fact exponentially stable (but with a fairly small stability margin). Because of this, it is possible to alternatively use the Low-Gain Robust Controller (\texttt{LowGainRC}) to achieve output tracking and disturbance rejection. Construction of this controller is included in the main file (code commented out). However, the small stability margin of the controlled PDE system also severely limits the size of the achievable closed-loop stability margin. On the other hand, in the simulation example the Reduced Order Observer Based Controller achieves a much higher closed-loop stability margin and convergence rate of the output while only having $4$ additional state variables than the Low-Gain Robust Controller (whose order is \emph{minimal}), and with only very reasonable increase in the control input gain. For a more detailed comparison of the performances of the two controllers, you can see~\citel{PauPhaMTNS20}{Sec.~4}, and complete similar simulations by uncommenting the construction of the Low-Gain Robust Controller in the main simulation file.



Figure~\ref{fig:BeamKV} shows the outputs of the simulation example.

\begin{figure}[h!]
  \begin{minipage}{0.48\linewidth}
    \begin{flushleft}
      \includegraphics[width=0.9\linewidth]{BKVoutputs.pdf}
    \end{flushleft}
  \end{minipage}
  \begin{minipage}{0.48\linewidth}
    \begin{flushright}
      \includegraphics[width=\linewidth]{BKVprofile.png}
    \end{flushright}
  \end{minipage}
    \caption{Example outputs of the controlled Kelvin--Voigt beam.}
  \label{fig:BeamKV}
\end{figure}

\medskip

\subsubsection*{Example: A Timoshenko beam with collocated in-domain control and observation}
~\\[-1ex]

\noindent Main file name: \texttt{TimoshenkoLHMNC18\_Main.m}

\medskip

The example is related to the article~\cite{PauLeG22}.
The controlled Timoshenko beam with constant parameters $\rho$ (mass density), $I_\rho$ rotary moment of inertia, $E$  Young's modulus, $I$ moment of inertia, $K$ shear modulus, is given by
\eq{
\rho \pd[2]{w}{t}(\xi,t) &= K \pdb{\xi} \left( \pd{w}{\xi}(\xi,t)-\phi(\xi,t) \right) - d_w \pd{w}{t}(\xi,t)\\
I_\rho \pd[2]{\phi}{t}(\xi,t) &= EI\pd[2]{\phi}{\xi} + K\left( \pd{w}{\xi}(\xi,t)-\phi(\xi,t) \right) \\
& \hspace{3cm}- d_\phi \pd{\phi}{t}(\xi,t) + \chi_{[1-\eta,1]}(\xi)u(t).
}
Here $w(\xi,t)$ is the displacement of the beam at $\xi\in(0,1)$ and $\phi(\xi,t)$ is the rotation angle of the beam. The $d_w$ and $d_\phi$ are viscous damping parameters. 
The control acts through the input profile $\chi_{[1-\eta,1]}(\cdot)$ (the characteristic function of the interval $[1-\eta,1]$ for some $\eta<1$).
The measured output (which is collocated with the control input) is given by
\eq{
y(t) = \int_{1-\eta}^1 \pd{\phi}{t}(\xi,t)dt.
}

In the simulation example the physical parameters of the model are 
\eq{
\rho=1, \quad
 I_\rho = 1, \quad
E=1, \quad
I=1, \quad
K=1, \quad
d_w=2, \quad
d_\phi=2, \quad
\eta = 0.2.
}

In this example, the PDE model is approximated with Finite Differences scheme. This scheme is very simple and easy to implement, but it should be noted that literature offers several more reliable and advanced numerical approximation methods for this class of hyperbolic PDEs, and some of these are able to, for example, preserve the \emph{port--Hamiltonian} structure of the control system.

By default, the control design used in the example is the Passive Robust Controller (\texttt{PassiveRC}), which was also the controller of choice in~\cite{PauLeGLHMNC18}. This controller can be used because the system is both exponentially stable and impedance passive.
Because the control system has bounded input and output operators, it is also possible to use other control design methods, for example the Observer Based Robust Controller (\texttt{ObserverBasedRC}) or the Dual Observer Based Robust Controller (\texttt{DualObserverBasedRC}). The former is implemented and commented out in the code. For these alternative controller designs, the parameters $K_{21}$ and $L$ (the stabilizing state feedback and output injection gain) can be designed using ``collocated design'' as $K_{21} = -\kappa_K B^\ast$ and $L=-\kappa_L C^\ast$ for some gain parameters $\kappa_K,\kappa_L>0$.

Figure~\ref{fig:BeamTim1} shows the outputs of the simulation example.

\begin{figure}[h!]
  \begin{minipage}{0.48\linewidth}
    \begin{flushleft}
      \includegraphics[width=\linewidth]{BTim1outputs.pdf}
    \end{flushleft}
  \end{minipage}
  \begin{minipage}{0.48\linewidth}
    \begin{flushright}
      \includegraphics[width=0.95\linewidth]{BTim1profile.png}
    \end{flushright}
  \end{minipage}
    \caption{Example outputs of the controlled Timoshenko beam.}
  \label{fig:BeamTim1}
\end{figure}



\section{Contributors}

%The purpose is to plan a lightweight software package for simulating robust output regulation of (approximated) distributed parameter systems within Matlab.

\begin{description}
  \item[Lassi Paunonen] Project leader, developer (2017--)
  \item[Jonne Karru] Developer (2021)
  \item[Mikko Aarnos] Developer (2018)
  \item[Jukka-Pekka Humaloja] Developer (2018--)
\end{description}



  \appendix

\section{External Links}

\begin{itemize}
  \item \href{https://sysgrouptampere.wordpress.com}{https://sysgrouptampere.wordpress.com} --- Systems Theory Research Group at Tampere University.
  \item  \href{https://github.com/lassipau/rorpack/}{https://github.com/lassipau/rorpack/} --- RORPack for Python
  \item  \href{https://github.com/lassipau/rorpack-matlab/}{https://github.com/lassipau/rorpack-matlab/} --- RORPack for Matlab
\item \href{https://lassipau.github.io/rorpack/}{https://lassipau.github.io/rorpack/}  --- RORPack homepage (hosted by GitHub Pages)
  \item \href{http://mathesaurus.sourceforge.net/matlab-numpy.html}{http://mathesaurus.sourceforge.net/matlab-numpy.html} --- Useful information on differences in the Matlab and Python/Numpy syntax for vectors and matrices.
  \item \href{https://chebfun.org}{https://chebfun.org} --- Homepage of the Chebfun Project.
\end{itemize}

\shorten{

  \section{Code: TODO}

  \begin{itemize}
    \item
  \end{itemize}

  TODO [\blue{Later}]
  \begin{itemize}
    \item Integrate the use of \texttt{FEniCS/Dolfin}
    \item Extend construction to systems with complex parameters (need to include values $P(-i\gw_k)$ etc, find a general way to handle both real and complex systems at the same time?
    \item improved color choices for the plots, define ``styles'', e.g., ``temperature'', ``general'', ``deflection''
    \item Youtube Video lecture on usage of RORPack!
  \end{itemize}
}

%Key features:
%\begin{itemize}
%  \item Run from a separate script with specific structure
%  \item Implemented Matlab routines for
%    \begin{itemize}
%      \item Design of controllers (Low-gain, observer-based, observer-dual, simple passive)
%      \item Simulation and plotting of output
%    \end{itemize}
%  \item Platform for defining routines for 
%    \begin{itemize}
%      \item System parameter definitions
%      \item Illustrating the behaviour of solution
%    \end{itemize}
%\end{itemize}
%
%{\color{blue}Note:} If implemented properly, the package could also be used in teaching on the Linear Systems course! (Note to self: Consider changing the name to ``(Introduction to) Mathematical Systems Theory'' to get rid of the overlap in course naming). In this situation the students could build new tutorial examples as course final project works, and these could be published online.
%
%\section{Functionality}
%
%\subsection{From the User's Perspective}
%
%Modular structure of the Robust Controller simulations:
%
%Typical process steps (corresponding to the structure of the control script):
%
%\begin{enumerate}
%%  \item PDE system:
%
%\item Define the PDE system, output $(A,B,B_d,C,D,D_d)$
%
%  \begin{itemize}
%    \item Manual definition, different scenarios, 1D, 2D etc
%    \item Definition from PDE Toolbox data
%    \item Other sources?
%  \end{itemize}
%
%\item Define the reference and disturbance signals, output $\yref(\cdot)$, $\wdist(\cdot)$, and $\set{\gw_k}_k$.
%%  exosystem $(S,E,F)$ and the signals
%
%\item Construct the controller, output $(\mc{G}_1,\mc{G}_2,K)$. Implemented routines for 
%  \begin{itemize}
%    \item Robust low-gain controller
%    \item Observer-based
%    \item Reduced-order controller
%    \item Reduced order IM?
%    \item Approximate regulation?
%  \end{itemize}
%
%    Including: Optimize controller parameters numerically to achieve desirable closed-loop properties? Requires input of the plant parameters. 
%%    Could be seen as part of the controller construction
%
%    Ques: Separate the internal model construction?
%
%  \item Construct the closed-loop system
%
%  \item Simulate the closed-loop system state
%
%  \item Illustrate the output and the error
%
%    \begin{itemize}
%      \item Pointwise plots vs. error integral plots
%    \end{itemize}
%
%  \item Animate the solution of the controlled PDE
%    \begin{itemize}
%      \item Different routines based on the source of the approximation (Manual, PDE Toolbox, other)
%    \end{itemize}
%\end{enumerate}
%
%\subsection{Additional functionality}
%
%Supporting routines
%\begin{itemize}
%  \item Simulation based routine for finding $P(i\gw_k)$ for stable systems
%    \begin{itemize}
%      \item could also be applied for finding $P_K(i\gw_k)$ for other controller structures?
%    \end{itemize}
%\end{itemize}
%
%\section{Implementation}
%
%
%\subsection{Data Structures}
%
%Define a class 'linear system' to be applied for the plant, the controller, and the exosystem.
%
%
%\section{Details on the Routines}
%
%%Controller construction routines:
%
%\subsection{Controller Construction Routines}
%
%\subsubsection{Robust Low-Gain Controller}
%
%    Input data:
%    \begin{itemize}
%      \item IM frequencies
%      \item Output space dimension
%      \item Values $P(i\gw_k)$ 
%      \item Value of the gain $\eps$, vs. range of the gain and $(A,B,C,D)$ for the optimization procedure. What is the best criterion? CL stability margin?
%    \end{itemize}
%
%    Output data:
%    \begin{itemize}
%      \item $(\mc{G}_1,\mc{G}_2,K)$, and $\eps$
%    \end{itemize}
%
%    Comments on the routine:
%    \begin{itemize}
%      \item Optimality concerns for $K$, $\mc{G}_2$? Could add in later revisions when the theory is developed. Or could directly follow HamPoh...
%    \end{itemize}
%
%    Questions: Complex vs real form? Maybe real would be better in any case...
%
%
%    \subsection{System Definition Routines}
%
%%System definition routines:
%
%\subsubsection{General form PDE definition}
%	Most important: general form output data.
%
%    Usage:
%    \begin{itemize}
%      \item \texttt{[sys,x0] = ConstSys2DheatDirBC(...)} with sys.A, sys.B, sys.Bd, sys.C, sys.D
%      \item \texttt{x0 = ConstSys2DheatDirBC(...)}
%    \end{itemize}
%
%    Input data:
%    \begin{itemize}
%      \item PDE parameters
%      \item Initial state as a function handle
%    \end{itemize}
%
%    Output data:
%    \begin{itemize}
%      \item System parameters $(A,B,B_d,C,D,D_d)$
%      \item Initial state
%    \end{itemize}
%
%  Remark: The same function could be used to define only the inital state. 
%
%  Question: Include possibility for a mass matrix?
%
%  \section{Extensions in the Future}
%
%
%  \begin{itemize}
%    \item Possibility to do a version for ORP (without robustness
%      \begin{itemize}
%	\item Main difference: Requires exosystem instead of signals. Or can we represent the theory without the exosystem?
%%	  CL system forms: based on exosystem state vs yref(t) and wdist(t)? Implement both first?
%      \end{itemize}
%    \item Incorporate functionality to create models using the Matlab PDE Toolbox built in routines (define geometry, PDE parameters, input and output operators, FEM approximation)
%  \end{itemize}
%  
%  \section{Plan for 2018}
%
%
%%\bibliographystyle{plain}
%%\bibliography{../reference}
%
%
%\section{A Little Less Important Issues}
%
%\subsection{Name Suggestions}
%
%\begin{itemize}
%  \item RORPack
%  \item ROR(P)Lab
%  \item RORSim
%\end{itemize}



\bibliographystyle{plain}
\bibliography{../../../../../Dropbox/Work/Research/reference}
%\bibliography{Introduction-to-RORPack-for-Matlab}
\end{document}
